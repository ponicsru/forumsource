---
title: "Изготовление ЕС-метра с непрерывным измерением"
sidebar: ponics_sidebar
---

**siv237** 24-05-2017

Решил задокументировать свой опыт по созданию ЕС-метра из ардуинки и куска проволоки.

Возможно кому-то покажется полезным:

[![](/imagehost2/thumbs/latestcb20170522063921pathprefi.png)](https://t.me/ponics_ru_files/18535){:target="_blank"}

[http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino](http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino){:target="_blank"}

Математические расчеты: http://forum.ponics.ru/index.php?topic=2645.msg120831#msg120831

Пример установки: http://forum.ponics.ru/index.php?topic=2645.msg120656#msg120656


**cpf** 24-05-2017

Замечание, предложение и вопрос:

1. ТермокомпЕнсация - пишется через "Е"

2. Изначально рассчитать 2-3 коэффициента для "популярных" растворов и дать возможность их выбора. Понятно, что будет погрешность, но КМК, она будет меньше, чем без ТК.

3. Насколько сложно сделать калибровку ТК по нескольким точкам? Т.е. "прикрутить" термометр, нагреть раствор до 40гр, и пока он остывает до 25гр (или ниже) - снять значения EC для нескольких точек и пересчитать для 25гр. Т.е. ввести режим "калибровка ТК" ?


**siv237** 24-05-2017

> Замечание, предложение и вопрос:
> 
> 1. ТермокомпЕнсация - пишется через "Е"
> 
> 2. Изначально рассчитать 2-3 коэффициента для "популярных" растворов и дать возможность их выбора. Понятно, что будет погрешность, но КМК, она будет меньше, чем без ТК.
> 
> 3. Насколько сложно сделать калибровку ТК по нескольким точкам? Т.е. "прикрутить" термометр, нагреть раствор до 40гр, и пока он остывает до 25гр (или ниже) - снять значения EC для нескольких точек и пересчитать для 25гр. Т.е. ввести режим "калибровка ТК" ?

1. Чем хорош движок вики, так это тем, что можно все быстро поправить любому сочувствующему или не согласному :)

2. Не уверен, что это возможно и имеет смысл, но для более точного расчета вполне можно использовать справочные данные по зависимости электропроводности от температуры и все, бы хорошо и можно рассчитать реальный раствори и функцию компенсации, но еще надо не забывать, что есть еще коэффициенты температурной деформации которые уже относятся к электродам. Электроды в теплом растворе становятся толще и изгибаются по непредсказуемым углом, что тоже внесет свою роль.

В общем по практике, температура влияет не настолько сильно, что-бы заморачиваться.

3. Снимая постоянно статистику по температуре и электропроводности никаких сложностей нет и вполне можно это даже автоматизировать.


**Пресвятой_ДжимБим** 24-05-2017

#include &lt;OneWire.h&gt;

#include &lt;DallasTemperature.h&gt;

#define ONE_WIRE_BUS 10 // линия сигнала с темп.датчика

const int TempProbePossitive =8;//плюсовой провод от темп.датчика

const int TempProbeNegative=9; //минусовой провод от темп.датчика.

OneWire oneWire(ONE_WIRE_BUS);

DallasTemperature sensors(&amp;oneWire);

float TemperatureCoef = 0.019;

float Temperature=10;

float ECt =0;

raw =0;

//Далее твои переменные, касаемые ec-сенсора.

void setup()

{

//Сетапируй тут свой ес-сенсор.

pinMode(TempProbeNegative , OUTPUT ); 

digitalWrite(TempProbeNegative , LOW);

pinMode(TempProbePossitive , OUTPUT );

digitalWrite(TempProbePossitive , HIGH );

delay(100);

sensors.begin();

delay(100);

}

void loop(){

sensors.requestTemperatures();

Temperature=sensors.getTempCByIndex(0); 

// Далее снимаешь показания с ес-сенсора, и записываешь в переменную raw. Или как ты там вычисляешь?

ECt = raw/ (1+ TemperatureCoef*(Temperature-25.0));

}

Вот тебе температурная компенсация.

И да, не благодари. :D


**Пресвятой_ДжимБим** 24-05-2017

Ds18B20 если что.


**siv237** 24-05-2017

> Вот тебе температурная компенсация.
> 
> И да, не благодари. :D

Да вы батенька шутник :) Формула компенсации общеизвестна, проблема именно в коэффициенте.

В общем сперва прочтите написанное :)


**Пресвятой_ДжимБим** 24-05-2017

Ладно, не парься. Вечером с компа посмотрю.


**Пресвятой_ДжимБим** 24-05-2017

> > Вот тебе температурная компенсация.
> > 
> > И да, не благодари. :D
> 
> 
> 
> Да вы батенька шутник :) Формула компенсации общеизвестна, проблема именно в коэффициенте.
> 
> В общем сперва прочтите написанное :)

Это вы батенька шутник. :D

У вас огромный диапазон температур от -50 до +50?))))

Голову не надо делать!) Или в голову))))

Для гидропоники я в коде указал необходимый коэффициент.

Сделал такой шикарный подарок, подставляй циферы, да пользуйся! Ан нет, нос воротят. Мол, нафига нам розы, нам дай в куче навоза поковыряться. ;D


**siv237** 24-05-2017

> > > Вот тебе температурная компенсация.
> > > 
> > > И да, не благодари. :D
> > 
> > 
> > 
> > Да вы батенька шутник :) Формула компенсации общеизвестна, проблема именно в коэффициенте.
> > 
> > В общем сперва прочтите написанное :)
> 
> 
> 
> Это вы батенька шутник. :D
> 
> У вас огромный диапазон температур от -50 до +50?))))
> 
> Голову не надо делать!) Или в голову))))
> 
> Для гидропоники я в коде указал необходимый коэффициент.
> 
> Сделал такой шикарный подарок, подставляй циферы, да пользуйся! Ан нет, нос воротят. Мол, нафига нам розы, нам дай в куче навоза поковыряться. ;D

Да нет такого коэффициента, он только ваш личный, для вашего раствора, для ваших электродов.


**Cyclamech** 24-05-2017

Интересно, если работоспособно…

А на непрерывное измерение pH посоветуете "забить" или тоже что "заколхозить" можно?

…

Я почитал Ваш код. Никогда не писал под что-то подобное, но есть моменты.

Я бы убрал из кода все "волшебные числа": 5000, 11, 10… Обозначил бы их константами или переменными с говорящими сами за себя именами и присвоил бы им значение в единственном месте - потом легко было бы править.

Я не понял Вашу методу расчёта среднего арифметического. Например, имеем 3 измерения: a, b, c. Каково среднее? (a+b+c)/3, т.е., по трети от каждого значения. Вы же предлагаете (a+b)/2, потом ((a+b)/2+c)/2. В Вашем случае мы не получим сумму третей, а будет сумма четвертей a и b плюс половина c. *???*

Я, конечно, предварительно перечитаю "[Историю одного байта](http://www.vitmar.h10.ru/onebyte.htm){:target="_blank"}", если вдруг решу заняться "ардуиной". *crazy*


**Пресвятой_ДжимБим** 24-05-2017

> > > > Вот тебе температурная компенсация.
> > > > 
> > > > И да, не благодари. :D
> > > 
> > > 
> > > 
> > > Да вы батенька шутник :) Формула компенсации общеизвестна, проблема именно в коэффициенте.
> > > 
> > > В общем сперва прочтите написанное :)
> > 
> > 
> > 
> > Это вы батенька шутник. :D
> > 
> > У вас огромный диапазон температур от -50 до +50?))))
> > 
> > Голову не надо делать!) Или в голову))))
> > 
> > Для гидропоники я в коде указал необходимый коэффициент.
> > 
> > Сделал такой шикарный подарок, подставляй циферы, да пользуйся! Ан нет, нос воротят. Мол, нафига нам розы, нам дай в куче навоза поковыряться. ;D
> 
> 
> 
> Да нет такого коэффициента, он только ваш личный, для вашего раствора, для ваших электродов.

Время нас рассудит)

Нет чтоб на практике проверить, мы готовы спорить до усери :D


**Пресвятой_ДжимБим** 24-05-2017

 Теоретики, блин. Из-за одного теоретика я как-то немерянно бабла потерял. Теперь теоретиков сразу увольняю взашей без объяснения причин. Ибо пустотрепство меня не устраивает. Ты сначала сделай, а потом трепись о своем изделии хоть до посинения, но не в ущерб фирме, и деньгам.


**Vad** 24-05-2017

> Да нет такого коэффициента, он только ваш личный, для вашего раствора, для ваших электродов.

ух ты :D

PS

Вот с появлением вики-шмики.... и начался разнос грязи на обуви..

каждый пишет всякую ересь туда, а так как ресурс выглядит авторитетным, то "нигамматныи" воспринимают инфу за чистую монету :D

По такой схеме вся БАД и гомеопатия работает :D

Кучерявый дядя в белом халате, с подписью внизу "Профессор, член РАН, Ибраил Михаилович Эедельштам" рассказывает о пользе Мумия :D


**siv237** 24-05-2017

> > Да нет такого коэффициента, он только ваш личный, для вашего раствора, для ваших электродов.
> 
> 
> 
> ух ты :D

При изменении температуры меняется и размер электродов, их форма и соответственно их площадь контакта и расстояние между друг другом. Или нет? :)


**siv237** 24-05-2017

> Интересно, если работоспособно…
> 
> А на непрерывное измерение pH посоветуете "забить" или тоже что "заколхозить" можно?
> 
> …
> 
> Я почитал Ваш код. Никогда не писал под что-то подобное, но есть моменты.
> 
> Я бы убрал из кода все "волшебные числа": 5000, 11, 10… Обозначил бы их константами или переменными с говорящими сами за себя именами и присвоил бы им значение в единственном месте - потом легко было бы править.
> 
> Я не понял Вашу методу расчёта среднего арифметического. Например, имеем 3 измерения: a, b, c. Каково среднее? (a+b+c)/3, т.е., по трети от каждого значения. Вы же предлагаете (a+b)/2, потом ((a+b)/2+c)/2. В Вашем случае мы не получим сумму третей, а будет сумма четвертей a и b плюс половина c. *???*
> 
> Я, конечно, предварительно перечитаю "[Историю одного байта](http://www.vitmar.h10.ru/onebyte.htm){:target="_blank"}", если вдруг решу заняться "ардуиной". *crazy*

Это не итоговый рабочий код, это я специально вынул из своего (у меня много что измеряет одна ардуина и влажность и температуру воздуха и растворов и несколько электродов).

Тут код именно больше как прототип, для понимания, как работает. Я думал добавить еще измерения на противофасе по неактивному измерителю через падение напряжения 1024-A0 и A1, но подумал нет смысла усложнять.

По pH уже почти месяц лежит шилд и электрод для ардуины, все никак руки не дойдут.

[![](/imagehost2/thumbs/photo20170524180805.jpg)](https://t.me/ponics_ru_files/18536){:target="_blank"}


**Пресвятой_ДжимБим** 24-05-2017

> > > Да нет такого коэффициента, он только ваш личный, для вашего раствора, для ваших электродов.
> > 
> > 
> > 
> > ух ты :D
> 
> 
> 
> При изменении температуры меняется и размер электродов, их форма и соответственно их площадь контакта и расстояние между друг другом. Или нет? :)

Уххаха!))))

"Дядя, ты дурак?"(с)

Если ты раствор заморозишь до +2, то изменится размер электродов. Если нагреешь раствор до +100, то тоже изменится.

Вот только на практике, и в здравом уме никто этого делать не будет.

А разброс температур в гидропонике +-10С°.

При большем разбросе температур раствора растишки благополучно могут сдохнуть. И на расширение или сужение твоего сенсора им будет на растительных небесах глубоко фиолетово.

И кстате, коэфф. Который я привел - это не моя прихоть. Он взят из многих источников(забугорных) по гидропонике. И подтверждался этот коэфф на практике , а не в пропуканом кресле перед компом.


**siv237** 24-05-2017

> Время нас рассудит)
> 
> Нет чтоб на практике проверить, мы готовы спорить до усери :D

Лично я чистый практик. Теорию изучаю, когда сталкиваюсь с практическими проблемами :)

У меня сейчас 3 рабочих измерителя и коэффициенты такие, подобраны на глаз:

0.021 - на алишном электроде из нержавейки 

0.018 - на первом АВВГ алюминиевом

0.019 - на втором АВВГ алюминиевом


**siv237** 24-05-2017

> Дык я тоже Вад :D ;D
> 
> Тезки=)
> 
> Ну глупость ведь говоришь про расширение электродов в рабочем растворе)) 
> 
> Очевидную.

[http://tehtab.ru/guide/guidephysics/guidephysicsheatandtemperature/heatexpansioncoefficient/linearextensionmanymaterials/](http://tehtab.ru/guide/guidephysics/guidephysicsheatandtemperature/heatexpansioncoefficient/linearextensionmanymaterials/){:target="_blank"}

Для алюминия 22 (10-6 м/(мK)) / ( 10-6 м/(мoС)) на градус. Пересчитай, как измерится площадь контакта электрода с раствором.

Да и не в электродах дело, они и правда не сильно влияют, в отличии от состава электролита.


**serge mat** 25-05-2017

> Решил задокументировать свой опыт по созданию ЕС-метра из ардуинки и куска проволоки.
> 
> Возможно кому-то покажется полезным:
> 
> ![](/imagehost2/thumbs/latestcb20170522063921pathprefi.png)
> 
> [http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino](http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino){:target="_blank"}

Я еще только собираюсь вводить ардуино в свою гидропонику. Пока нахожусь на стадии выбора компонентов. Мне очень интересно иметь измеритель ЕС, тем более практически бесплатный.

У меня, как у химика, вопрос о материале электродов. Согласен, платина - лучший вариант. Нержавеющая сталь - так себе сомнительный. Она ведь нержавеющая при обычных условиях, а в химических растворах - очень даже ржавеющая. И уж совсем непригодным мне кажется алюминий. Дело в том, что это чрезвычайно агрессивный металл, вытесняющий водород из воды и взаимодействующий с кислородом при обычных температурах. Что его предохраняет от таких разрушительных действий - это тонкая пленка на поверхности. Любой вариант электролиза, как катодный, так и анодный, может привести к разрушению этой пленки и тогда алюминий устремится в раствор. Этого точно не происходит?

Кроме того, один из законов химии - активные металлы вытесняют из растворов менее активные, замещая их своими ионами. Алюминий в питательном растворе может вытеснять железо (не хелатное), марганец и медь. Этих металлов мало, на электроде мы можем не заметить, но растения получат дефицит. 

С точки зрения химии электрод надо делать из самого пассивного металла из использованных в растворе. Это - медь. Не рассматривали такой вариант?


**siv237** 25-05-2017

> > Решил задокументировать свой опыт по созданию ЕС-метра из ардуинки и куска проволоки.
> > 
> > Возможно кому-то покажется полезным:
> > 
> > ![](/imagehost2/thumbs/latestcb20170522063921pathprefi.png)
> > 
> > [http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino](http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino){:target="_blank"}
> 
> 
> 
> Я еще только собираюсь вводить ардуино в свою гидропонику. Пока нахожусь на стадии выбора компонентов. Мне очень интересно иметь измеритель ЕС, тем более практически бесплатный.
> 
> У меня, как у химика, вопрос о материале электродов. Согласен, платина - лучший вариант. Нержавеющая сталь - так себе сомнительный. Она ведь нержавеющая при обычных условиях, а в химических растворах - очень даже ржавеющая. И уж совсем непригодным мне кажется алюминий. Дело в том, что это чрезвычайно агрессивный металл, вытесняющий водород из воды и взаимодействующий с кислородом при обычных температурах. Что его предохраняет от таких разрушительных действий - это тонкая пленка на поверхности. Любой вариант электролиза, как катодный, так и анодный, может привести к разрушению этой пленки и тогда алюминий устремится в раствор. Этого точно не происходит?
> 
> Кроме того, один из законов химии - активные металлы вытесняют из растворов менее активные, замещая их своими ионами. Алюминий в питательном растворе может вытеснять железо (не хелатное), марганец и медь. Этих металлов мало, на электроде мы можем не заметить, но растения получат дефицит. 
> 
> С точки зрения химии электрод надо делать из самого пассивного металла из использованных в растворе. Это - медь. Не рассматривали такой вариант?

Насколько я понял перелопатив литературу по защите алюминиевых конструкций в агрессивных средах, алюминий металлический устойчив в расторах наших солей благодаря оксидной пленке. Проблемы могут быть из-за наличия NH4.

Но все меняется при протекании постоянного электрического тока. Гальванический перенос может идти довольно активно. Провел опыт на ночь запитал 5 вольтами в растворе хлорида натрия. Утром 1 электрод покрылся толстой шапкой белого налета по ощущениям состоящей из твердых фракций, а второй черновато серой гадостью и электрод полностью стал хрупким и рассыпался в руках. Это за ночь.

Именно по этому для сохранности электродов и препятствования их взаимодействия с раствором требуется обеспечивать высокую частоту смены полярности электродов. Тогда грубо говоря ионы не успевают доплыть от одного электрода к другому и прореагировать, так как постянно меняют свое направление. А перенос идет заряда идет за счет выстраивания их в цепочку принципом вагончиков. Толкаем задний двигается передний и наоборот.

Кроме того, приложенный переменный электрический потенциал снижает разрушение алюминиевых конструкций даже в сравнении с конструкциями к которым потенциал не приложен. 

Если я правильно понял принцип, то постоянно меня местами анод и катод можно значительно повысить сохранность алюминия в агрессивных средах, что используют в промышленности и кораблестроении.

Потому я реализовал принцип непрерывного, а не периодического измерения, что-бы не оставлять электроды без приложенных потенциалов.

Ну и алюминий считается относительно безопасным для растений и для здоровья человека. Его вообще если я не ошибаюсь любой в земле огромное количество вроде 3й по распространенности металл на земле.

В любом случае я пока веду испытания 3 недели зрительно разрушения электродов не происходит. Контрольные растворы расхождения в электропроводности пока не показывают. 

Ну и с учетом стоимости и простоты даже изготовления можно хоть раз в месяц новый изготавливать, но чувствую это не потребуется.

К меди отношусь очень с подозрением. Слишком она хорошо окисляется сама по себе в растворе. Просто кусок проволоки в бутылке с раствором становится черным через сутки, при этом при протирании остается зеленый осадок. К проводу никаких потенциалов не было приложено просто случайно упал.


**Borodach1** 25-05-2017

> Ну и алюминий считается относительно безопасным для растений и для здоровья человека.

Это откуда такая оптимистическая информация? :o


**siv237** 25-05-2017

> > Ну и алюминий считается относительно безопасным для растений и для здоровья человека.
> 
> 
> 
> Это откуда такая оптимистическая информация? :o

Я же сказал относительно. Мы и растения окружены этим элементом. Считается, что алюминий опасен для растений в виде солей с концентрацией более 1 мг/л. Вреден ли алюминий для людей - тут много мнений и в основном последние годы медицина однозначна - вреден. Но тем не менее алюминиевая посуда не запрещена, более того в любом общепите ложки и вилки из алюминия практически неизменны уже более полувека.

Думаю тут надо вопрос ставить так, в каких количествах и в каких формах вреден алюминий для людей и растений. Ну коли у ученых четкого мнения на этот счет нет, то нам точно не найти истину :)

Так что вывод такой: если есть возможность не использовать алюминий. то лучше его не использовать. Но если уж и попало немного в раствор ,особенно в металлической его форме, то не смертельно, в отличии от мышьяка например в тех же количествах, который может содержаться в некоторых промышленных солях.


**Cyclamech** 25-05-2017

> Вреден ли алюминий для людей - тут много мнений и в основном последние годы медицина однозначна - вреден. Но тем не менее алюминиевая посуда не запрещена, более того в любом общепите ложки и вилки из алюминия практически неизменны уже более полувека.
> 
> Думаю тут надо вопрос ставить так, в каких количествах и в каких формах вреден алюминий для людей и растений. Ну коли у ученых четкого мнения на этот счет нет, то нам точно не найти истину :)

Отчего же нам-то и не найти истину? *Bos*

Стоит попробовать паять алюминий - и станет понятно, что чистый алюминий непросто встретить в природе: на воздухе сразу образуется оксид алюминия - прочное и стойкое соединение (корунд), с которым, по сути, всё и контактирует. Алюминий, покрытый оксидной плёнкой, в нашем случае можно считать "инертным" материалом. Безвредным.


**siv237** 25-05-2017

> Отчего же нам-то и не найти истину? *Bos*
> 
> Стоит попробовать паять алюминий - с станет понятно, что чистый алюминий непросто встретить в природе: на воздухе сразу образуется оксид алюминия - прочное и стойкое соединение (корунд), с которым, по сути, всё и контактирует. Алюминий, покрытый оксидной плёнкой, в нашем случае можно считать "инертным" материалом. Безвредным.

Значит нужно обеспечить её сохранение. Где-то читал, что именно аммоний NH4 самый опасный для этой пленки компонент, но что-то источник не могу снова найти.

А с пайкой алюминия при правильном флюсе больших проблем нет. Но да, флюс разрушает пленку.


**Borodach1** 25-05-2017

Алюминий это довольно интересный металл. Он взаимодействует как с кислотами так и со щелочами.

Это совсем не пригодный для электродов материал.

Ко всему этому, сульфат алюминия используют в водоподготовке как коагулянт. Так что в питьевой воде можно считать он уже есть. А Вы ещё его добавляете в попытке растворить свои электроды.

Сохранить оксидную плёнку? :-\ Можно... если лаком покрыть. :D Но какой тогда во всём этом смысл? *???*


**Borodach1** 25-05-2017

Предлагаю перейти на магниевые электроды! *8)*

Хоть какая то польза будет от их растворения. :)


**serge mat** 25-05-2017

> > > Ну и алюминий считается относительно безопасным для растений и для здоровья человека.
> > 
> > 
> > 
> > Это откуда такая оптимистическая информация? :o
> 
> 
> 
> Я же сказал относительно. Мы и растения окружены этим элементом. Считается, что алюминий опасен для растений в виде солей с концентрацией более 1 мг/л. Вреден ли алюминий для людей - тут много мнений и в основном последние годы медицина однозначна - вреден. Но тем не менее алюминиевая посуда не запрещена, более того в любом общепите ложки и вилки из алюминия практически неизменны уже более полувека.
> 
> Думаю тут надо вопрос ставить так, в каких количествах и в каких формах вреден алюминий для людей и растений. Ну коли у ученых четкого мнения на этот счет нет, то нам точно не найти истину :)
> 
> Так что вывод такой: если есть возможность не использовать алюминий. то лучше его не использовать. Но если уж и попало немного в раствор ,особенно в металлической его форме, то не смертельно, в отличии от мышьяка например в тех же количествах, который может содержаться в некоторых промышленных солях.

Соединения алюминия окружают нас с древних пор. По сути, соединения алюминия - основной компонент каждой глины. Как мы знаем, на глинистых почвах растения могут расти. И из глиняной посуды люди едят издревле. 

Конечно, если нажраться сразу много растворимых солей алюминия - может и станет плохо, но в небольших количествах алюминий считается безвредным для людей и для растений.


**Borodach1** 25-05-2017

Кривая логика. :(

Следуя Вашей логике соли натрия и калия окружают нас всю жизнь, значит если Вы проглотите пару грамм натрия или калия, то ничего страшного не случится? ;)


**serge mat** 25-05-2017

> Кривая логика. :(
> 
> Следуя Вашей логике соли натрия и калия окружают нас всю жизнь, значит если Вы проглотите пару грамм натрия или калия, то ничего страшного не случится? ;)

Да, если проглотить пару грамм соли калия или натрия.

Здесь нет ничего кривого.

Алюминий - на электроде. Если он попал с электрода в раствор, то это уже соль алюминия (или гидроксид).


**Borodach1** 25-05-2017

А ещё химик!))) Разве я писал про соли? Я предлагал Вам проглотить пару грамм натрия или калия. 

Ладно. Сформулирую по другому. 

Знакома Вам поваренная соль? ;)

Давайте сделаем по честному. Я глотаю 1 моль NaCl, а Вы проглатываете 1 моль Na и тут же занюхиваете одним молем хлора.))) 

Каждый из нас получит одинаковое количество натрия и хллра. Но... Кому из нас поплохеет? А?;)

Какой смысл говорить о керамической посуде и алюминиевых столовских ложках если мы говорим совсем о другом??? 


**siv237** 26-05-2017

> Какой смысл говорить о керамической посуде и алюминиевых столовских ложках если мы говорим совсем о другом???

А о чем мы говорим? Вроде обсуждали электроды. Электроды из алюминиевой проволоки АВВГ в воде не окисляются благодаря защитному слою оксида толщиной всего несколько нанометров, покрывающему металлический алюминий практически мгновенно 2Al2O3. 

Му обсуждаем, два вопроса если я не ошибаюсь:

1. Стабильность измерений электродами из алюминия

2. Вред наличия алюминия в растворе

Оба вопроса завязаны на то, переходит ли алюминий из электродов в раствор. В большинстве источников утверждается, что алюминиевые сплавы не содержащие примеси меди химически не взаимодействуют с большинством агрессивных сред, большинства кислот и изделия из алюминия даже используются в технологическом процессе их производства, транспортировки и хранения.

В общем я вижу ситуацию более в практичном плане. Если за достаточно долгое время показатели измерения электропроводности через алюминиевые электроды не изменяются, то и значимого взаимодействия с раствором не происходит.

Осталось определиться с тем самым временем, сколько это - "достаточно долго", ведь всем понятно, что платиновые электроды всяко дольше сохранят свои свойства.


**Borodach1** 26-05-2017

> В большинстве источников утверждается, что алюминиевые сплавы не содержащие примеси меди химически не взаимодействуют с большинством агрессивных сред, большинства кислот и изделия из алюминия даже используются в технологическом процессе их производства, транспортировки и хранения.

Большинство источников, агрессивных сред и кислот в студию! :D

Нафига тогда мы в ответственные места суём медь, сталь, золото и платину? У нас же есть самый благороднейший, великолепнейший и совсем не токсичный алюминий? ;)

> Если за достаточно долгое время показатели измерения электропроводности через алюминиевые электроды не изменяются, то и значимого взаимодействия с раствором не происходит.

Опять всё построено на одном единственном и сомнительном допущении. На допущении о том, что всегда существует непокобелимая оксидная плёнка.

А как влияет оксидная плёнка на проводимость? А кто сказал, что она у Вас там вообще есть?

> ...на воздухе сразу образуется оксид алюминия - прочное и стойкое соединение...

Ключевое слово на воздухе!!!

А может нужно принять другое, более вероятное допущение, что плёнка в нашей агрессивной среде, да ещё и под воздействием электрических токов постоянно разрушается? А новая либо не успевает вырасти, либо вообще не растёт. Доступа к атмосферному кислороду то нет? Примерно как при паянии алюминия с флюсом. Плёнку растворили, доступ к кислороду ограничили, оно возьми и залудись. А? ;)

Следующий камень в алюминиевый огород:

> Кроме того, один из законов химии - активные металлы вытесняют из растворов менее активные, замещая их своими ионами. 

Этого то Вы не будете отрицать?

Подвожу итоги. Вам уже три неВадима говорят, что алюминий это очень активный металл. Он не пригоден для электродов. Вы слышите??? Ау-у-у!!!


**siv237** 26-05-2017

> Подвожу итоги. Вам уже три неВадима говорят, что алюминий это очень активный металл. Он не пригоден для электродов. Вы слышите??? Ау-у-у!!!

С тем, что алюминий активный металл все ясно, тут никто не спорит вроде? 

При этом хотел бы вернуть вас в лоно обсуждения практического применения. Мы говорим не о чистом алюминии, а о алюминии покрытом аксидной или гидроксидной пленкой (которая кстати в воде образовывается не менее активно, чем в на воздухе), являющейся очень устойчивой к коррозионному воздействию. Даже естественная пленка обеспечивает защиту алюминия от взаимодействия со многими неорганическими кислотами, например тару для хранения азотной кислоты часто изготавливают из алюминия.

Кроме того широко используется технология, которая называется анодирование алюминия. Выполняется она в агрессивных средах (например в серной кислоте) под действием постоянного тока, которое позволяет нарастить защитную пленку и значительно повысить коррозионные свойства. При этом анодирование лишь частный случай такого характерного явления для алюминия, которое называется пассивирование. Упрощенно, это означает, что чем сильнее на алюминий воздействуют агрессивные среды, тем сильнее и толще становится защитная пленка и тем слабее он продолжает реагировать с этой средой.

Кроме того, мы обсуждаем даже не сам алюминий даже, а электрод из провода АВВГ, в сплаве которого активно используются добавки, повышающие его стойкость. Благодаря этому алюминиевые провода активно используют в таких местах, где медные подвержены коррозии.

Вот, что сказано о назначении кабеля АВВГ при его использовании:

Рекомендуется к использованию в помещениях сырых, частично затапливаемых при наличии среды с высокой коррозионной активностью.


**siv237** 26-05-2017

> Вот сижу, читаю эти алюминиевые бредни.. и думаю..
> 
> вокруг одни идиоты.. делают электроды из дорогущего металла... со сложными (по меркам siv237) аналоговыми штуками...
> 
> а нужно из алюминия и на ардуине.. :-\

Вад предложи вариант лучше по соотношению доступность/результат и спора не будет.

Никто не утверждает, что алюминиевые провода это вообще идеальное решение. Вопрос идет не о качестве, а о стоимости и простоте решения.

Есть еще дешевый вариант - иглы от шприцев, но как их заизолировать?

Придумай вариант проще чем с алюминиевым проводом или вилкой от электроприбора, как предлагает твой юнный падаван :)


**siv237** 26-05-2017

> Как мне кажется .. это характеристика изоляции :D
> 
> потому что... запрещено использовать провод с поврежденной изоляцией..

Просто поинтересуйся, что такое сталеалюминиевые провода и почему ими линии электропередач выполнены без всякой изоляции? Даже к твоему дому думаю не менее пары таких идут. Сроки их службы десятками лет измеряется.


**siv237** 26-05-2017

> где написано, что их можно сувать в заптапливаемые помещения?
> 
> ёжик в тумане ;D

В курсе, что провода обычно имеют начало и конец и в этих местах они подключены в щитках например, которые в тех-же условиях находятся, в подвалах домов например?

Слышал про дожди и прочие атмосфорные явления? А провода со стальной несущей жилой обмотанные алюминиевой проволокой, десятилетиями висят и не окисляются. Алюминий очень устойчивый материал к внешним воздействиям. Хватит уже юлить. не загоняй себя в очередной тупик.


**orgail** 26-05-2017

давайте уже изобретайте, чтоб вообще без электродов!

а то вы тут проводами скоро душить друг друга будете :D :D :D


**Cyclamech** 26-05-2017

> А провода со стальной несущей жилой обмотанные алюминиевой проволокой, десятилетиями висят и не окисляются. Алюминий очень устойчивый материал к внешним воздействиям.

Биметаллические провода, ИМХО, сделаны не для противостояния среде, а для удешевления - переменный ток течёт по поверхности проводника и есть смысл эту поверхность сделать из хорошо проводящего материала (например, алюминий), а сердечник стоит сделать просто прочным (например, из дешёвой стали). Так мне один знакомый линейный монтёр связи под пиво объяснял про биметалл - типа нечего там воровать - просто "алюминиевое напыление". *???*


**orgail** 26-05-2017

да господи))) просто люмень :D :D :D он дешевый, легкий и более менее проводящий ))) а сталь - да, прочная. ее как основу - канат)))

про поверхности - это он перемудрил))) скин эффект на этих частотах кажется далековато :D :D :D

шо за проблема вообще? электроды-муликтроды... есть нержавейка, чего еще надо для таких погрешностей


**Vad** 26-05-2017

> Биметаллические провода, ИМХО, сделаны не для противостояния среде, а для удешевления - переменный ток течёт по поверхности проводника и есть смысл эту поверхность сделать из хорошо проводящего материала (например, алюминий), а сердечник стоит сделать просто прочным (например, из дешёвой стали). Так мне один знакомый линейный монтёр связи под пиво объяснял про биметалл - типа нечего там воровать - просто "алюминиевое напыление". *???*

это этим монтерам рассказывают чтоб они провод не воровали ;D

скин слой для 50 герц ~9 мм


**Cyclamech** 26-05-2017

> это этим монтерам рассказывают чтоб они провод не воровали ;D
> 
> скин слой для 50 герц ~9 мм

Может, и так: у меня интерес к этим проводам пропал. :D :D :D


**siv237** 26-05-2017

Да никто и не спорит, что оплетка не ради антикорозии, а ради проводимости и медь дороже. Речь о том, что алюминий выдерживает долго. Нам на измерение раствора хватит на месяц точно. Ничего вредного в раствор не выделится за это время. С учетом допустимой суточной дозы для человека 40 мг в день.

Эффект вытеснения электронов во внешние слои проводников на переменном токе актуален для высоких напряжений ЛЭП, а алюминий явно не для этого. Просто по стальной жиле слишком большое падение на низких напряжениях, а без стали алюминий не выдержит ветровую нагрузку.

По поводу электродов без проводов была интересная тема, которую ксати Вад тоже охаивал. Человек предлагал использовать в качестве электродов столбики раствора внутри шприцов. Можно снова поднять это.


**Cyclamech** 26-05-2017

Вот и я поддерживаю идею "минимальной достаточности": это то, что нужно для домашних "колхозов". Я, к примеру, весьма наплевательски отношусь к процессу и, возможно, именно мне и подойдут подобные темы. А значит, подойдут любой домохозяйке. *???*


**Пресвятой_ДжимБим** 26-05-2017

Странный человек. Говорит о общедоступном ec-метре, а сам в какие-то дебри лезет.

Ты дай общедоступное-то?

По полочкам:

Вот дуина и ес-метр, вот код к нему, вот код термокомпенсации, вот код калибровки.

Где это в сборе-то?

Какие проблемы?

Словеса тока по экрану размазываешь.


**siv237** 26-05-2017

> Странный человек. Говорит о общедоступном ec-метре, а сам в какие-то дебри лезет.
> 
> Ты дай общедоступное-то?
> 
> По полочкам:
> 
> Вот дуина и ес-метр, вот код к нему, вот код термокомпенсации, вот код калибровки.
> 
> Где это в сборе-то?
> 
> Какие проблемы?
> 
> Словеса тока по экрану размазываешь.

Ну ссылка в первом посте же.


**Vad** 26-05-2017

> По поводу электродов без проводов была интересная тема, которую ксати Вад тоже охаивал. Человек предлагал использовать в качестве электродов столбики раствора внутри шприцов. Можно снова поднять это.

а как ты столбики будешь подключать к своей ардуине ;D

у нее же нет жидкостных портов ;D *Dance*


**Vad** 26-05-2017

А напомните мне.. на кой пень мы аналоговые пины с цифровыми сочленили? :D

я чета не вкурю смысла *Bravo*


**Пресвятой_ДжимБим** 26-05-2017

> А напомните мне.. на кой пень мы аналоговые пины с цифровыми сочленили? :D
> 
> я чета не вкурю смысла *Bravo*

Ы! А может на тех цЫфровых типа ШИМ? не!? ;D


**siv237** 26-05-2017

> А напомните мне.. на кой пень мы аналоговые пины с цифровыми сочленили? :D
> 
> я чета не вкурю смысла *Bravo*

Вот уже предметный разговор похоже начинается.

В инструкции из сылки в первом посте я подробно расписал принцип действия, но возможно сумбурно получилось:

Принцип работы

Измерение происходят следующим образом:

Условно положительная фаза

С цифровой порт D10 переводится в режим высокого уровня (1 HIGH), а D11 низкого.

Ток напряжением 5В устремляется через раствор в сторону D11.

При этом измеритель A1 возвращает значение падения напряжения на этом промежутке в цифровом виде.

Затем уровень D10 снова переходит в состояние (0 LOW)

Измерение на первой фазе завершено 

Условно отрицательная фаза

С цифровой порт D11 переводится в режим высокого уровня (1 HIGH), а D10 низкого.

Ток напряжением 5В устремляется через раствор в сторону D10.

При этом измеритель A0 возвращает значение падения напряжения на этом промежутке в цифровом виде.

Затем уровень D11 снова переходит в состояние (0 LOW) 

Таким образом за 1 цикл измерений происходит полная смена полярности от +5В до 0 до -5В до 0

Измерения выполняются максимальной скоростью (для arduino uno это ~3.5 КГц)

Итоговые значения измеренные за период на положительной и отрицательной фазе усредняются, что повышает точность измерения, а затем усредняются между собой. 


**siv237** 26-05-2017

> А законченного и общедоступного устройства нет.

Вот как ты себе представляешь законченное устройство? Для меня лично это система сбора и обработки статистики с десятков источников, с ведением архивов, сработкой аварийных событий и уведомлениями на telegram.

С доступом к системе из любой точки мира как на простомтр так и модификацию через впн.

Она у меня работает и этот измеритель часть этой системы один из многих.

Я не понимаю, зачем нужны всякие экраны индикаторы кнопочки на тупой железке, когда есть центр обработки информации высокой надежности но для многих это может казаться полезным.

Я все-же вижу двухкомпонентную схему, где есть сборщик и обработчик в виде компа. Но хотел бы мнение услышать форумчан.


**siv237** 26-05-2017

В общем предметно.

Предлагаю любому желающему тут на форуме собрать схему, а я обязуюсь помочь с решением конечной задачи отображения результата в том виде, в котором этот форумчанин захочет в разумных пределах :)


**siv237** 26-05-2017

> У меня загруженная по всем канонам ардуина(пинов свободных нет), и тоже как-то в serial рассказывает о своём поведении. Там и кнопка калибровки есть, и кнопка режима полива, и датчики уровня раствора, и соленоид от осмоса, и освещалка, и датчик влажности. И ещё помпы дозирующие. И обо всем этом рассказывается по serial. Тока в циферку, а не в графиках. Система автоматизации на то и дана, дабы многое(не все) делалось без участия человека.

А у меня все на компе, и автоматически. Мне даже кнопку каоибровки не надо. Я просто подошел положил электрод в первый раствор, потом во второй, а потом когда у компа спокойно внес компенсацию. Любые планы полива и контроля я могу сделать сидя у любого компа посмотреть графики хоть с телефона по дороге домой, изменить режимы да даже виде о с камер посмотреть как и что растет. 

Но я понимаю, что такая схема не особо близка любому. Просто моя работа связанна с компами и я всегда практически рядом с одним из них.


**Vad** 26-05-2017

> В общем предметно.
> 
> Предлагаю любому желающему тут на форуме собрать схему, а я обязуюсь помочь с решением конечной задачи отображения результата в том виде, в котором этот форумчанин захочет в разумных пределах :)

Я хочу вот так :D

[![](/imagehost2/thumbs/dscn2804.jpg)](https://t.me/ponics_ru_files/18537){:target="_blank"}

(2013 год)

поможешь? :D *crazy*


**siv237** 26-05-2017

> > В общем предметно.
> > 
> > Предлагаю любому желающему тут на форуме собрать схему, а я обязуюсь помочь с решением конечной задачи отображения результата в том виде, в котором этот форумчанин захочет в разумных пределах :)
> 
> 
> 
> Я хочу вот так :D
> 
> [![](/imagehost2/thumbs/dscn2804.jpg)](https://t.me/ponics_ru_files/18538){:target="_blank"}
> 
> (2013 год)
> 
> поможешь? :D *crazy*

[![](/imagehost2/thumbs/sensorsnwn.png)](https://t.me/ponics_ru_files/18539){:target="_blank"}

[![](/imagehost2/thumbs/eculu.png)](https://t.me/ponics_ru_files/18540){:target="_blank"}

[![](/imagehost2/thumbs/sensors2.png)](https://t.me/ponics_ru_files/18541){:target="_blank"}

[![](/imagehost2/thumbs/ec2.png)](https://t.me/ponics_ru_files/18542){:target="_blank"}

В моей теме были графики асутп системы управления климатом в боксе в прошлом году с подстройкой по коридорам температуры влажности освещенности и прочее. В этом году я просто измеряю и управляю поливом.


**Vad** 26-05-2017

чувак, это ардуина рисует))

измеряет, считает, калибруется, сохраняет в свою БД, управляет процессом, отправляет в сеть статистику, управляется через вэб интерфейс... ну и.. и рисует...))


**siv237** 26-05-2017

> Вот, например, меня по нескольку дней дома не бывает, чем мне поможет статистика на компе, ежели у меня pH поднялся до 7,5?? 
> 
> Так и говори, что это не общедоступное решение.

Э шев ну вы это потише, мы вроде обсуждаем непрерывыный измеритель ЕС а не контроллер. Посмотри мою тему балконные приключения за прошлый год. Там полное управление климатом было, ЕС и pH не измерял но статистику вел ручную.

> З.ы. А вот меня от компов тошнит.

Ты просто не умеешь их готовить :)


**siv237** 26-05-2017

> чувак, это ардуина рисует))
> 
> измеряет, считает, калибруется, сохраняет в свою БД, управляет процессом, отправляет в сеть статистику, управляется через вэб интерфейс... ну и.. и рисует...))

А у меня малина это рисует отправляет и прочие бла бла есть еще сервер хранения прост опотому что он у меня есть, он дублирует.

Уверен твоя ардуина с обвесом всех шилдов стоит дороже. Кстати один из графиков ЕС считает малина с прикрученой АЦП шкой, правда к сожалению тормозной. Больше 600 герц не успевает pcf8591 да и битность не к черту но даже её хватает для измерения, хоть и не так кучно.


**Vad** 26-05-2017

из шилдов только преобразователь уровней 5-3.3 для дисплея :D

остальное, я делаю сам..

потому что могу..))


**orgail** 26-05-2017

пацаны :D :D :D не стреляйте друг в друга :D :D :D ;D ;D ;D


**siv237** 26-05-2017

> В общем. ~~Микроскопом~~ ардуино гвозди забиваешь, делая из нее измеритель ЕС.

Я бы выразился иначе, использую тупую железку за 100 рублей как банк аналоговых портов с 10 битным АЦП которую можно размножить за 5 минут в колличестве.


**** 26-05-2017

Прошу прощения, я со стороны простого обывателя:

О! Нашел простой метод измерить ЕС!!!!

Набрал ардуин, запутался в выборе электродов(люминь платина иль нержавка).

С горем пополам подключил. Уффф.

Загрузил код Сива в ардуину.

И... Нихера не поймет, что дальше делать?? Где надпись "ЕС="?

В телевизор глянул, там нету.

В микроволновку, холодильник, коту под лапу.. а заветной надписи то и нету.

Хнык..

В общем, грустная сказка.


**siv237** 26-05-2017

> Прошу прощения, я со стороны простого обывателя:
> 
> О! Нашел простой метод измерить ЕС!!!!
> 
> Набрал ардуин, запутался в выборе электродов(люминь платина иль нержавка).
> 
> С горем пополам подключил. Уффф.
> 
> Загрузил код Сива в ардуину.
> 
> И... Нихера не поймет, что дальше делать?? Где надпись "ЕС="?
> 
> В телевизор глянул, там нету.
> 
> В микроволновку, холодильник, коту под лапу.. а заветной надписи то и нету.
> 
> Хнык..
> 
> В общем, грустная сказка.

Ну справедливо. 

Он видет на экране циферку, в сыром виде, а дальше по формулам калибровки получает ЕС.

Всеравно придется взять калькулятор в руки или эксель и подсчитать. Для того формулы и даны и я считаю ооочень упростил расчет калибровки. Изначально у меня была 10 точечная но проведя измерения я понял, что хватит и двух с достаточной для гидропонике точностью. Одной точки 100% не хватит.

Я о том и говорю вставить 3 строки расчета в код с моими коэффициентами не проблема, но у каждого будут свои значения калибровки. Записать в ардуину автоматику расчета, она не запомнит и после ресета все потеряет. Что-бы не потеряла нужно вписывать в код на жесткую, а это не универсально и не правильно или цеплять шилд под флешку для хранения переменных и статистики измерений.

Какие другие варианты? Думаю тот, кто разберется как в ардуину залить код сможет за 15 минут понять, как свои дорасчеты внести. Или спросить.

В общем более законченный вид потребует значительно больших базовых знаний и завысит слодность. Думаю считать решение этой задачки первым шагом, что бы не пересыщать ман.

Добавить дачик температуры и код компенсации с выходом ЕС и передачей на комп например можно сделать вторым маном. Кто-то например захочет просто на экран вывести что тоже ман? Все остальные задачи они просто типовые и легко гуглятся и копипастятся.


**** 26-05-2017

А ты слышал когда-нибудь волшебное слово eeprom?


**siv237** 26-05-2017

> А ты слышал когда-нибудь волшебное слово eeprom?

Расскажи очень интересно :)


**siv237** 26-05-2017

> Я мог бы написать кусок кода под твой ЕС прям сейчас. С записью калибровочных коэфф.в eeprom, и последующим чтением в переменные.
> 
> Но тебе это не нужно. 
> 
> Да и я не хочу уже.
> 
> Один раз писал уже.

Вся хитрость ардуины в том, что она вдоль и поперек расписана примерами готовыми и библиотеками. Любой желающий возьмет и за 5 минут станет обладателем сокровенных знаний.

Демострационный код для решения одной задачи не должен быть перегружен кодом решения другой. Он просто должен выполнять свою задачу. Остальные задачи не сложно как конструктор добавить по необходимости.

Ведь сам посуди, вот сделаешь ты код выполнения калибровки с записью в ппзу и что? Как он будет выполнять в какие моменты? Нужно писать логику интерфейса работы с пользователем, кнопочки там, а тут уже эранчик или лампочки и прочие внешние подверждения. И все ради чего?

Можно конечно просто с компа передать нужные значения и записать в память, но во первых если есть комп то проще на компе и смотреть результат и считать функции или в конце концов просто вписать в тело кода нужные значения.

В общем не очевидно.

Все это полезно при изготовлении готового законченного устройства - контроллера. У меня такой задачи нет. Есть пример решения одной функциональной задачи максимально простым способом.


**Cyclamech** 26-05-2017

> А вообще почувствовать себя не признаным гением может почти каждый участник этого форума. Достаточно просто попробовать рассказать огороднику любителю навоза, а лучше целому дачному кооперативу про гидропонику :)

Верно: меня в результате просто банили на тёткоцветочных форумах… *crazy* *Dance* *Bravo*


**siv237** 12-06-2017

Спустя месяц непрерывных измерений на ~5V 3,3 kHz 

Фабричный электрод с али с контактами из неизвестного материала

[![](/imagehost2/thumbs/photo20170612210732.jpg)](https://t.me/ponics_ru_files/18542){:target="_blank"}

Электрод из алюминиевого провода АВВГ

[![](/imagehost2/thumbs/photo20170612210727.jpg)](https://t.me/ponics_ru_files/18543){:target="_blank"}

Показания по обоим не уплыли за это время.


**Пресвятой_ДжимБим** 12-06-2017

Просьба к тебе небольшая. Проведи небольшой эксперимент. 

Попробуй свою конструкцию на более высоких уровнях ЕС.

Ну к примеру 6. И оставь на сутки.

Мне важно знать результат измерений, а также состояние электродов.

Сам бы провел. Но не одной ардуины не осталось.

В конце недели только привезут((


**siv237** 12-06-2017

> Просьба к тебе небольшая. Проведи небольшой эксперимент. 
> 
> Попробуй свою конструкцию на более высоких уровнях ЕС.
> 
> Ну к примеру 6. И оставь на сутки.
> 
> Мне важно знать результат измерений, а также состояние электродов.
> 
> Сам бы провел. Но не одной ардуины не осталось.
> 
> В конце недели только привезут((

Ну вообще я тестирование начинал на стабильность именно на очень крепком растворе хлорида натрия, где-то ложка соли на литр. 

Но я все собираюсь заняться уровнемером на основе измерения электропроводности. Нужно только всё на работу притащить, так что и 6 ЕС без проблем и 20 если интересно. Постараюсь на неделе.


**siv237** 14-06-2017

Улучшил код не изменяя схему, теперь измерения производятся сразу двумя АЦП за каждый полупериод, стабильность измерений значительно возросла.

Добавил в код экспоненциальную калибровку по двум точкам. 

Теперь ес выводится сразу в порт без учета компенсации температуры.


**Пресвятой_ДжимБим** 14-06-2017

Молодец. Растешь)

Можешь упростить замеряя только один полупериод.


**siv237** 14-06-2017

> Молодец. Растешь)
> 
> Можешь упростить замеряя только один полупериод.

Так точность выше. 

Кстати измерил ток между D10 и D11 когда один в нуле второй в единице: 63,3 мА получилось.


**Пресвятой_ДжимБим** 14-06-2017

Дабы уменьшить поляризацию и повысить точность(наверное) нужен ровный меандр. При твоём коде может уплыть скважность, вернее не может, а точно уплывает.

Плюс выполнение команд analogwrite() влечет за собой задержку по времени(небольшую, но все же).

digitalwrite() тоже занимают какое-то время, но в твоём случае можно принебречь.


**siv237** 14-06-2017

> Дабы уменьшить поляризацию и повысить точность(наверное) нужен ровный меандр. При твоём коде может уплыть скважность, вернее не может, а точно уплывает.
> 
> Плюс выполнение команд analogwrite() влечет за собой задержку по времени(небольшую, но все же).
> 
> digitalwrite() тоже занимают какое-то время, но в твоём случае можно принебречь.

Теоретически, если продолжительность положетельной фазы и отрицательной будет немного отличаться в одну сторону, но постоянно, то ионы рано или поздно "доплывут" от одного электрода к другому. Но не надо еще забывать о моменте инерции. В отличи от электронов, которые его почти не имеют, ионы значительно более тяжело сдвигаются да и скорости совсем не световые.

В общем даже в твоей предложенной схеме, где просто импульсы не меняющие направление движения ионов, процесс электролиза протекает совсем не быстро, а тут знакопеременная сила.

В общем нет смысла совсем в этом направлении даже копать. Точность интервалов не важна, как и не важна синусоидальность, особенно полученная через шим. Единственные негативные моменты связанные с прямоугольными импульсами, это насколько я помню повышенные наводки из-за некоторых эффектов связанных с переходными процессами в проводниках.

Но мы говорим об устройстве из двух проводков с ценой в 170 рублей.


**** 14-06-2017

Ну по большому счету надо вести речь о законченном устройстве. А не о теории.

Дабы обычный пользователь купил железку с экранчиком, залил скетч, и пользовался не заморачиваясь.


**siv237** 14-06-2017

> Ну по большому счету надо вести речь о законченном устройстве. А не о теории.
> 
> Дабы обычный пользователь купил железку с экранчиком, залил скетч, и пользовался не заморачиваясь.

Да я же не против, но мы так и не пришли к этому пониманию, что такое устройство для конечного пользователя?

Прицепить экранчик и выводить ЕС наверно это здорово, но всё-же хочется статистику, так как важна именно динамика изменения, а не мгновенные значения. А чем и как её выводить?

Я могу легко выложить скрипты связки ардуины с малинкой, которая и будет собирать статистику и рисовать графики отдавать их через вебморду. Но это уже 2 устройства, а не одно.


**Пресвятой_ДжимБим** 14-06-2017

Блин. Да простому гидропонщику не нужны графики, ему нужно знать относительно точный уровень ЕС. Кому нужны графики - тот пойдет дальше, и считает данные с serial, и построит свой график на чем угодно(было бы желание). Сам.


**siv237** 14-06-2017

> Блин. Да простому гидропонщику не нужны графики, ему нужно знать относительно точный уровень ЕС. Кому нужны графики - тот пойдет дальше, и считает данные с serial, и построит свой график на чем угодно(было бы желание). Сам.

Ну тут я думаю с тобой многие не согласятся. Значительно важнее знать именно тенденцию и скорость изменения ЕС, нежели его точное значение.


**...Andrew...** 14-06-2017

> Прицепить экранчик и выводить ЕС наверно это здорово, но всё-же хочется статистику, так как важна именно динамика изменения, а не мгновенные значения. А чем и как её выводить?

Если дисплей графический то не проблема и графики выводить. 

Вот, я когда-то выводил суточные графики температуры и влажности, вполне информативно получалось:

![](http://ifotohost.com/pic/280/69o6p5.jpg)


**Пресвятой_ДжимБим** 14-06-2017

> > Прицепить экранчик и выводить ЕС наверно это здорово, но всё-же хочется статистику, так как важна именно динамика изменения, а не мгновенные значения. А чем и как её выводить?
> 
> 
> 
> Если дисплей графический то не проблема и графики вы
> 
> водить. 
> 
> Вот, я когда-то выводил суточные графики температуры и влажности, вполне информативно получалось:
> 
> ![](http://ifotohost.com/pic/280/69o6p5.jpg)

Ну тоже верно. Прицепить графический экран, плюс Sd-card для записи/чтения данных.

И вот тебе статистика.


**Borodach1** 14-06-2017

> ...что за "эффекты", что за "переходные процессы в проводниках"? ;D

Ну... :-\

Наверное он исходит из того, что оксид алюминия это полупроводник.

Вот и прут они они, процессы...

:D


**siv237** 14-06-2017

> Наверное он исходит из того, что оксид алюминия это полупроводник.

Наверно вы очень переживаете за алюминий? Не у вас ли там платиновые электроды за пол семейного бюджета? *8)*

[https://ru.wikipedia.org/wiki/Переходные_процессы_в_электрических_цепях](https://ru.wikipedia.org/wiki/Переходные_процессы_в_электрических_цепях){:target="_blank"}

Кратко, при наличии реактивных элементов в цепи ( они всегда есть) в моменты изменения протекающего по цепи тока, могут быть очень сильные мгновенные скачки напряжения и тока.


**Пресвятой_ДжимБим** 14-06-2017

Побитово включаем и выключаем цифровые пины. И вот вам 8мГц частоты.


**siv237** 14-06-2017

> Побитово включаем и выключаем цифровые пины. И вот вам 8мГц частоты.

Да находил как раз сегодня статейку, но не разобрался еще. Сможешь помочь?

Вот это оно? https://geektimes.ru/post/255744/


**Пресвятой_ДжимБим** 14-06-2017

> > Побитово включаем и выключаем цифровые пины. И вот вам 8мГц частоты.
> 
> 
> 
> Да находил как раз сегодня статейку, но не разобрался еще. Сможешь помочь?
> 
> Вот это оно? https://geektimes.ru/post/255744/

Не совсем оно. Статья странная и сложная. Всё проще.

Гугли на тему: "Меандр на ардуино"

На форуме ардуино.ру выползет миллион примеров кода. И с применением внутр.таймеррв, и без.

Вот и вся помощь.

Позже выложу кусок кода для понимания.


**orgail** 14-06-2017

а что с переходными процессами? они, конечно, всегда есть. Но, "скрытые" емкости или индуктивности там такие, что могут сильно влиять на процесс? в таких схемах влияние такое же, как и от скин-эффекта, не? 


**siv237** 14-06-2017

> а что с переходными процессами? они, конечно, всегда есть. Но, "скрытые" емкости или индуктивности там такие, что могут сильно влиять на процесс? в таких схемах влияние такое же, как и от скин-эффекта, не?

На коротких проводах и емкости и индуктивности смешные, а на таких мизерных напряжениях конечно никакого значимого эффекта нет, потому и не нужно запариваться с синусоидами и квадратная переменка просто и достаточно.


**Пресвятой_ДжимБим** 14-06-2017

> а что с переходными процессами? они, конечно, всегда есть. Но, "скрытые" емкости или индуктивности там такие, что могут сильно влиять на процесс? в таких схемах влияние такое же, как и от скин-эффекта, не?

Есть такое дело.. Но тут подход к каждому коду д.б. индивидуален, я щетаю. В зависимости от того какой результат хотим получить, мне так кажется.


**orgail** 14-06-2017

давайте тогда еще для этой схемы рассчитаем туннельный эффект :D :D :D а вдруг!


**Borodach1** 14-06-2017

> > Наверное он исходит из того, что оксид алюминия это полупроводник.
> 
> 
> 
> Наверно вы очень переживаете за алюминий?

Я? Я не переживаю. *???* Я за Вашу оксидную плёнку переживаю. :D

Она то ли диэлектрик, то ли полупроводник... Растворяется и в кислотах, и в щелочах... А ещё корундом её вдруг называют... Льстецы! :)

Похоже она ещё и сама не определилась кем ей быть. Вот и переходит из одной крайности в другую. Отсюда и переходные процессы. А Вы её в агрессивную среду! Да электричеством, чуть ли не высокочастотным, пытать! &gt;:D

> Не у вас ли там платиновые электроды ...

Не, это у нас тут практически все российские запасы платины. :-X Вот я и впариваю её кому попало. :D


**Borodach1** 14-06-2017

А чего тут переводить? 

От тебя самого то какая польза? 

Перечисляю твои достижения :

Кондуктометрический метод определения ионов - показывает только то что ты хочешь, а не то что есть в растворе. 

Онлайн калькулятор который делался вроде для людей, но удобен только создателю, и который позволяет одновременно всем пользователям, мешая друг другу, вносить данные. 

Лечение от любой неясности длительным водным голоданием.

Алюминиевые электроды это совсем Жесть, или как говорят на Украине - Бляха!

Ничего не забыл? 

И это всё при полном нежелании что то слышать и понимать. В попытке упростить решение задачи Вы упираетесь в изначально абсурдную идею и начинаете её упорно развивать. 

Поймите, измерять высоту метанием барометра это не упрощение решения задачи. Это в оригинале был один из шуточных вариантов решения скучной задачи. И таких вариантов было несколько. Я уверен, что ни одним из них ни кто не пользуется. 

С Вами всё наоборот. В попытке забить гвоздь Вы хватаете в руку первое попавшееся - микроскоп. Да, неудобно, но это только по началу. Поворачивая его так и сяк, взвешивая, расчитывая пару недель силу и угол удара, меняя хватку, пару раз выпрямляя согнутый гвоздь цель всё таки достигнута. Гвоздь вбит.

Вами найден новый метод забивания гвоздей, практически осчастливлено всё человечество! Вы радуетесь.. А вот мы почему то нет... (((


**siv237** 14-06-2017

> > А поверь, когда человека не понимают, именно его считают дураком, а не себя!
> 
> 
> 
> это глубокое заблуждение..
> 
> попал неандерталец в НИИ, и никого не понимает :D
> 
> потому. что вокруг одни дураки :D

Вот смотри как твой мозг работает. Тут очень показательный пример.

Я написал так, что человек который не понимает оппонента, в данном случае твой неандерталец, именно его считает дуракам, т.е. в твоем примере, сотрудников НИИ. 

Но ты приравнял быть дураком и считаться дураком.

Я еще раз говорю, что именно ты хочешь услышать про переходные процессы? 

Почему при прямоугольной и трапецеидальной форме переменного тока наводки при прочих равных выше от проводников этого самого тока, нежели от этих же проводников в которых течет синусоидальный ток?

И связанно это именно с переходными процессами вызывающие высокие кратковременные перераспределения токовых и напряженческих пиковых значений по времени. Я же тебе даже ссылку на википедию скинул, хотя там не очень понятно и сухо наверно для тебя. Нужно заранее понимать о чем речь. В любом учебнике физики старших классов уверен этот процесс описан более понятно для тебя. Только не читай учебников церковно-приходских школ.

Чем выше пиковые токи, тем выше пиковая напряженность переменного магнитного поля. Именно переменное, а не постоянное магнитное поле наводит токи в электропроводящих элементах электронных систем.

Именно по этому в медицинской технике используют оборудование экстренного энергоснабжения с двойным преобразованием, с чистой синусоидой на выходе или вообще постоянный ток.

Но кому я рассказываю, толку 0.


**siv237** 14-06-2017

> А чего тут переводить? 
> 
> От тебя самого то какая польза? 
> 
> Перечисляю твои достижения :
> 
> Кондуктометрический метод определения ионов - показывает только то что ты хочешь, а не то что есть в растворе. 
> 
> Онлайн калькулятор который делался вроде для людей, но удобен только создателю, и который позволяет одновременно всем пользователям, мешая друг другу, вносить данные. 
> 
> Лечение от любой неясности длительным водным голоданием.
> 
> Алюминиевые электроды это совсем Жесть, или как говорят на Украине - Бляха!
> 
> Ничего не забыл? 
> 
> И это всё при полном нежелании что то слышать и понимать. В попытке упростить решение задачи Вы упираетесь в изначально абсурдную идею и начинаете её упорно развивать. 
> 
> Поймите, измерять высоту метанием барометра это не упрощение решения задачи. Это в оригинале был один из шуточных вариантов решения скучной задачи. И таких вариантов было несколько. Я уверен, что ни одним из них ни кто не пользуется. 
> 
> С Вами всё наоборот. В попытке забить гвоздь Вы хватаете в руку первое попавшееся - микроскоп. Да, неудобно, но это только по началу. Поворачивая его так и сяк, взвешивая, расчитывая пару недель силу и угол удара, меняя хватку, пару раз выпрямляя согнутый гвоздь цель всё таки достигнута. Гвоздь вбит.
> 
> Вами найден новый метод забивания гвоздей, практически осчастливлено всё человечество! Вы радуетесь.. А вот мы почему то нет... (((

 

Ну всё, что вы назвали моими достижениями есть по сути не мои достижения. Я просто стараюсь систематизировать и упростить опыт людей, которые в этой области собаку съели. Вы думаете я придумал "Кондуктометрический метод определения ионов"? Я его просто постарался адаптировать к нашим реалиям и поверьте он работает в той мере, в которой заявлен. Я им постоянно пользуюсь лично.

Есть попытка упростить вы правильно это отметили. Найти минимальное соотношение достаточности к доступности.

Но вот я не пойму ваших посылов. Я правильно понимаю, давайте ничего не делать и не придумывать. Всё уже придумано и сделано?

Вот лично мне интересен принцип того, чем я пользуюсь. Я хочу понимать, что делаю и любые утверждения стараюсь подтвердить для себя лично. А уже выводами делюсь и прошу заметить, все выводы я подкрепляю расчетами на универсальном языке математики на случай, если вдруг кто-то как и я критически отнесется и не захочет просто поверить в верность моих утверждений, как я не верю в чужие. Вдруг он захочет пройти моим путем и понять сам?

А если вы не хотите, то это и не для вас. Можно и мимо проходить спокойно. Вам должно быть и так комфортно в своей вере.


**Borodach1** 15-06-2017

> Вы думаете я придумал "Кондуктометрический метод определения ионов"? 

Даже и не думал так думать! :D

> Я его просто постарался адаптировать к нашим реалиям и поверьте он работает в той мере, в которой заявлен. Я им постоянно пользуюсь лично.

В оригинальном методе используются ионселективные электроды. Вы не задумывались почему? *???* Ну да, следуя Вашей логике, фирма Hanna просит за сульфат селективный электрод порядка 60-70 килорублей только ради того, чтобы накрыть с головой Ваш семейный бюджет. :D

А что у Вас? То вилка от телевизора, то кусок алюминиевого провода. *crazy*

Вы ничего ни к чему не адаптировали. Были потрачены титанические усилия по приматыванию скотчем учебника по электрохимии к гвоздодёру. :&#039;(

Весь Ваш метод условно может работать только при двух допущениях:

1) Нужно изначально поверить тому, что написано на упаковке.

2) Примеси не растворимы в воде и соответственно никак не влияют на проводимость раствора.

И нафига нам такая адаптация для идеального случая? *Wall*

Помните, как то одному товарищу, в химмаге продали вместо хч сульфата калия такой же хч, но сульфит калия? :o

Интересно, сколько сульфата калия определит Ваш метод в растворе хч сульфита калия? ;) Особенно если его там нет. :D :D :D


**allex_step** 15-06-2017

ну да..... ионселективные электроды для простого ЕС-метра - это сила... *sos* 

походу Бородач о чем-то своем тут пишет *???* 


**Borodach1** 15-06-2017

> Еще раз, методика не связанна с выявлением конкретных ионов конкретных веществ.

Даже и не сомневался в этом.

> В конкретно вашем случае как раз и выходит, что отделить сульфат от сульфида вы бы смогли, а точнее подтвердить маркировку удобрения или опровергнуть её.

Во первых. Случай не мой.

Во вторых. Не сульфид, а сульфит.

В третьих. Какой бы Вы сделали вывод, если бы Ваш метод показал, что в пакете 95% чистоты сульфат калия? Внесли бы корректировку в свой калькулятор и начали бы сыпать вместо сульфата калия чистейший сульфит калия.

> То есть методика отвечает на главный вопрос - соответствует ли заявленная производителем на упаковке информация реальности или нет.
> 
> Вы просто вносите значения с пачки, измеряете и получаете ответ да или нет. Он не говорит, что именно в упаковке. Он говорит, что как минимум очень похоже, что производитель не соврал.
> 
> А с учетом второй, дополнительной проверки по весу жидкого объема (проверка предсказанной плотности), вероятность ошибки близка 0.
> 
> Найти две соли имеющие одинаковые функции электропроводности и плотности в зависимости от концентрации у вас не выйдет.

Повторяю ещё раз. 

"Весь Ваш метод условно может работать только при двух допущениях:

1) Нужно изначально поверить тому, что написано на упаковке.

2) Примеси не растворимы в воде и соответственно никак не влияют на проводимость раствора."

Рассмотрим варианты. Как это у вас там называется, таблица истинности? ;)

1) Оба допущения неверны. Методика покажет хрен знает что.

2) Первое неверно, второе верно. Методика покажет хрен знает что.

3) Первое верно, второе неверно. Методика покажет хрен знает что.Потому, что мы не знаем сколько и каких растворённых примесей.

4) Оба допущения верны. Опа! :o Заработало! *Dance*

Вывод:

Ваша методика по сравнению табличных данных работает только в идеальном случае с хч солями.

В реальном случае, наблюдая как совпадение, так и расхождение с табличными данными, нельзя сделать никаких достоверных выводов. :&#039;(

Некоторые знания в электрохимии Вы получили. Это хорошо. :) Только область применения найти им не можете. Вот и тычите ими куда попало. Это плохо. :(

Получилось примерно как в фильме «Наверное, боги сошли с ума». :D

Кстати, если принять только первое допущение (а именно так все мы, кроме Вас, работаем с солями), то все Ваши манипуляции бессмысленны. :D


**siv237** 15-06-2017

> Примеси не растворимы в воде и соответственно никак не влияют на проводимость раствора.

Вот это допущение наиболее интересно. Как по вашему, если предположить, что примеси растворимы в воде и влияют на электропроводность, то какая их доля для вас остается приемлемой?

Ну вот допустим в пачке 95% нитрата калия, а остальное например хлорид натрия, но производитель заявил чистоту 95%. Вроде все честно.

Но готовы ли вы сыпать это удобрение?

Что мы увидим, если измерим эту соль? Условно будет видно, что нитрата калия там больше, чем 95%. Какие можно сделать выводы? Есть повод задуматься как минимум.

Другая ситуация, измерили удобрение, например аптечный сульфат магния. И вместо 99% чистоты, мы получаем 55%. Понятно, что нужно знать, что сульфат магния аптечный он семиводный и реально в пересчете на чистые его там всего половина.

Или еще ситуация, вы готовите из сухого удобрения одинаковый раствор замер которого показывает например 99.5% ожидаемых значений. Но вот вы летом во влажную поготу заметили, что появились комки. Готовите раствор, а замер показывает 97% например. Какие выводы можно сделать?

В общем я еще раз говорю, методика не панацея, но от явных фейлов может уберечь. Например соду с кальциевой селитрой вы не спутаете.

А есть еще куча методик подтверждения в домашних условиях. Плотность, температура фазового перехода, простые реакции с окрашиванием и прочее.

Да можно сказать, все ерунда. Главное микроклимат и побольше света, а удобрения и точность растворов на втором месте и будете правы.


**Borodach1** 15-06-2017

> Вот это допущение наиболее интересно. Как по вашему, если предположить, что примеси растворимы в воде и влияют на электропроводность, то какая их доля для вас остается приемлемой?

Это допущение интересно не приемлимостью мною или Вами.

Оно интересно тем, что искажает картину Ваших измерений. Мы не знаем какой набор примесей, сколько их и как они влияют на проводимость. Вы их влияние принимаете равным нулю. А это совсем не так. Поэтому все эти замеры можно сразу спустить в унитаз.

> А есть еще куча методик подтверждения в домашних условиях. 

Мне нравится ход Ваших мыслей! Температура плавления, кипения, разложения... :-\

Можно ещё добавить градус преломления. Выращиваем кристаллы. Пропускаем лучик. По углу отклонения определяем вещество. ;D


**siv237** 15-06-2017

> Мне нравится ход Ваших мыслей! Температура плавления, кипения, разложения... :-\
> 
> Можно ещё добавить градус преломления. Выращиваем кристаллы. Пропускаем лучик. По углу отклонения определяем вещество. ;D

Ну а по сути у вас какие предложения. Я так понимаю оставить все как есть и ничего не проверять, просто верить?


**orgail** 15-06-2017

как все. на анализ. в лабораторию. или покупать ХЧ

а гадание на кофейной гуще - хорошая зарядка для мозга. но только зарядка.


**Cyclamech** 15-06-2017

Надо бы Бородача к себе в тестеры… :-\


**Borodach1** 15-06-2017

> > Мне нравится ход Ваших мыслей! Температура плавления, кипения, разложения... :-\
> > 
> > Можно ещё добавить градус преломления. Выращиваем кристаллы. Пропускаем лучик. По углу отклонения определяем вещество. ;D
> 
> 
> 
> Ну а по сути у вас какие предложения. Я так понимаю оставить все как есть и ничего не проверять, просто верить?

А нам больше ничего и не остаётся. :&#039;(

У нас уровень не тот. Это большое хозяйство может себе позволить иметь иономер и набор электродов к нему. А у нас кишка тонка. :D Нашего бюджета только на китайские светодиоды и хватает. :)

Хотя... :-\ С другой стороны... :-\ Скорей всего у нас ещё уровень хоббийности не вырос. Покупают же некоторые гараж, второй автомобиль, мотоцикл в придачу и в каждую комнату по выгнутому телевизору во всю стену... *???*

Иономер с набором электродов выйдет значительно дешевле. А рука не поднимается... :( Жаба проклятая! :D

Вот лежит у меня на столе сейчас иономер И-160МИ. Подарили. :) Не рабочий. :( 

Открыл я его, а там нифига нет. Микросхема-капля смолой залитая и экран. Статикой наверное шваркнули. Закрыл я его, и лежит он у меня на столе уже 5 лет. Жаба душит выкинуть. :) А ещё я Хомяк. :-[

Ой отвлёкся. :) Итак, верить нужно. Но и совсем бездумно нельзя, проверять, в разумных пределах, тоже нужно. 

Первое. Это агрономная путаница с оксидами. За этим только глаз да глаз.

Второе внешний вид. Купил я тут по случаю сульфат аммония и хлорид калия, посмотрел на этот мусор, и пользовать ими сразу перехотелось. 100% я эту фирму больше покупать не буду.&gt;:( Лежат теперь в дальнем углу. :( Потому, что я хомяк. :)


**siv237** 15-06-2017

> Ой отвлёкся. :) Итак, верить нужно. Но и совсем бездумно нельзя, проверять, в разумных пределах, тоже нужно. 
> 
> Первое. Это агрономная путаница с оксидами. За этим только глаз да глаз.
> 
> Второе внешний вид. Купил я тут по случаю сульфат аммония и хлорид калия, посмотрел на этот мусор, и пользовать ими сразу перехотелось. 100% я эту фирму больше покупать не буду.&gt;:( Лежат теперь в дальнем углу. :( Потому, что я хомяк. :)

Все так, смотреть глазками, смотреть мутность и прочие органолептические принципы. Сам тему начинал для не кошерных удобрений. Но согласитесь, когда все вроде нравится, и выглядит хорошо, а еще и измерения совпали.

Прям уверенность возрастает, и в проблемах, если они появляются в выращивании, уже в последнюю очередь удобрения подозреваешь.


**siv237** 15-06-2017

В общем добавление дополнительных измерений снизило частоту опроса, стали уплывать показания. Так, что жертвовать скоростью опроса в угоду точности смысла нет.

По поводу ускорения нашел вот такое простое решение https://istarik.ru/blog/arduino/1.html

Прикрутив эту либу, скорость опроса существенно возросла. Пока запустил тест стабильности, завтра проверю.


**Пресвятой_ДжимБим** 15-06-2017

Не использовал бы ты эту либу)) ручками, ручками. Только на пользу пойдет.

Сдуру можно х*й сломать. Ибо свои 3кГц ты разгонишь до 60кГц. Подумай сам, ежели максимум в кондуктометрии(для двух электродов) около 8-10кГц, что будет с измерениями? Сам говорил, что скорость ионов не световая. Подумай про эффект вибрации ионов.

Далее. Ты либой разгонишь цифровые пины в 20раз. А аналоговое чтение останется на том же уровне?! И об этом подумай.

Поэтому в данной задаче только ручками. И только.

Задача нетривиальна.

Сам сломал голову когда-то..

Подскажу:

Разгоняй analogread() до 1мГц

И побитово с паузой в 100мкс включай и выключай цифровые пины.

И будет тебе щастье.


**siv237** 15-06-2017

> Не использовал бы ты эту либу)) ручками, ручками. Только на пользу пойдет.
> 
> Сдуру можно х*й сломать. Ибо свои 3кГц ты разгонишь до 60кГц. Подумай сам, ежели максимум в кондуктометрии(для двух электродов) около 8-10кГц, что будет с измерениями? Сам говорил, что скорость ионов не световая. Подумай про эффект вибрации ионов.
> 
> Далее. Ты либой разгонишь цифровые пины в 20раз. А аналоговое чтение останется на том же уровне?! И об этом подумай.
> 
> Поэтому в данной задаче только ручками. И только.
> 
> Задача нетривиальна.
> 
> Сам сломал голову когда-то..
> 
> Подскажу:
> 
> Разгоняй analogread() до 1мГц
> 
> И побитово с паузой в 100мкс включай и выключай цифровые пины.
> 
> И будет тебе щастье.

Чтение тоже этой либой прибавило.

Для меня просто это всё очень новое. С микроконтроллерами вообще и с ардуиной в частности практически никогда работал.

Я еще только осваиваюсь, буду изучать постепенно по мере наличия времени.

Кстати диапазон АЦП увеличил от 0 до 400 на ЕС=4,5, практически половина. Всего-то нужно было длину контактов электродов увеличить до 3 см, а расстояние между ними сократить до нескольких миллиметров. Отлично видит осмос. И стабильно его измеряет.


**siv237** 15-06-2017

Вот такой код на этой либе дает 41 кГц переменки, больше чем в 10 раз быстрее стандартного analogRead, и digitalWrite

D10_High;

val_m = A0_Read;

D10_Low;

m=(val_m+m)/2;

D11_High;

val_p = A1_Read;

D11_Low;

p=(val_p+p)/2; 

[http://paste.ubuntu.com/24868215/](http://paste.ubuntu.com/24868215/){:target="_blank"}


**siv237** 29-06-2017

Новая версия ПО.

[http://paste.ubuntu.com/24976593/](http://paste.ubuntu.com/24976593/){:target="_blank"}

Использована библиотека повышающая скорость опроса в 10 раз относительно стандартных функций

Добавлена возможность измерять уровень (пока в стадии отладки калибровки, но уже работает)

Добавил возможность получать данные с AM2320 через i2c

Добавил возможность подключения нескольких точек измерения с независимой калибровкой измерителей. Каждая точка состоит:

Датчик температуры 18b20

Трехконтактный электрод для измерения ЕС и уровня. Два стабильнопогруженных контакта и один с изменяемым погружением.

Добавлена возможность одновременного измерения в одной емкости или в электрически связанных емкостях без значимого взаимного влияния за счет использования z-состояний портов arduino.

Добавлены функции нелинейной калибровки ЕС и уровня и термокомпенсации

Добавлен наглядный вывод в консоль

Все значения переписаны через переменные и присвоения с сохранением быстродействия

если нет датчика AM2320 закомментировать строку:

//th.Read();

[![](/imagehost2/thumbs/1000cb20170622005913pathprefi.png)](https://t.me/ponics_ru_files/18544){:target="_blank"}

[![](/imagehost2/thumbs/20170629113256.png)](https://t.me/ponics_ru_files/18545){:target="_blank"}


**allex_step** 08-07-2017

[code]Arduino: 1.8.3 Hourly Build 2017/06/23 05:12 (Mac OS X), Board: "Arduino/Genuino Mega or Mega 2560, ATmega2560 (Mega 2560)"

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_Out" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:5:22: note: in definition of macro &#039;_D_Out&#039;

#define _D_Out(x) D##x##_Out

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:101:1: note: in expansion of macro &#039;D_Out&#039;

D_Out(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:101:7: note: in expansion of macro &#039;EC_DPin_A&#039;

D_Out(EC_DPin_A);

^

EC-meter_and_water_leveler:83: error: pasting "/* Цифровой пин ЕС-электрода B*/" and "_Out" does not give a valid preprocessing token

#define EC_DPin_B 11 // Цифровой пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:5:22: note: in definition of macro &#039;_D_Out&#039;

#define _D_Out(x) D##x##_Out

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:102:1: note: in expansion of macro &#039;D_Out&#039;

D_Out(EC_DPin_B);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:102:7: note: in expansion of macro &#039;EC_DPin_B&#039;

D_Out(EC_DPin_B);

^

EC-meter_and_water_leveler:86: error: pasting "/* Цифровой пин электрода уровня*/" and "_In" does not give a valid preprocessing token

#define Level_DPin_C 2 // Цифровой пин электрода уровня

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:3:21: note: in definition of macro &#039;_D_In&#039;

#define _D_In(x) D##x##_In

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:103:1: note: in expansion of macro &#039;D_In&#039;

D_In(Level_DPin_C);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:103:6: note: in expansion of macro &#039;Level_DPin_C&#039;

D_In(Level_DPin_C);

^

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_High" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:7:23: note: in definition of macro &#039;_D_High&#039;

#define _D_High(x) D##x##_High

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:108:3: note: in expansion of macro &#039;D_High&#039;

D_High(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:108:10: note: in expansion of macro &#039;EC_DPin_A&#039;

D_High(EC_DPin_A);

^

EC-meter_and_water_leveler:84: error: pasting "/* Аналоговый пин ЕС-электрода B*/" and "_Read" does not give a valid preprocessing token

#define EC_APin_B 0 // Аналоговый пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:11:23: note: in definition of macro &#039;_A_Read&#039;

#define _A_Read(x) A##x##_Read

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:109:17: note: in expansion of macro &#039;A_Read&#039;

ec_positive = A_Read(EC_APin_B)+ec_positive;

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:109:24: note: in expansion of macro &#039;EC_APin_B&#039;

ec_positive = A_Read(EC_APin_B)+ec_positive;

^

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_Low" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:9:22: note: in definition of macro &#039;_D_Low&#039;

#define _D_Low(x) D##x##_Low

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:110:3: note: in expansion of macro &#039;D_Low&#039;

D_Low(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:110:9: note: in expansion of macro &#039;EC_DPin_A&#039;

D_Low(EC_DPin_A);

^

EC-meter_and_water_leveler:83: error: pasting "/* Цифровой пин ЕС-электрода B*/" and "_High" does not give a valid preprocessing token

#define EC_DPin_B 11 // Цифровой пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:7:23: note: in definition of macro &#039;_D_High&#039;

#define _D_High(x) D##x##_High

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:112:3: note: in expansion of macro &#039;D_High&#039;

D_High(EC_DPin_B);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:112:10: note: in expansion of macro &#039;EC_DPin_B&#039;

D_High(EC_DPin_B);

^

EC-meter_and_water_leveler:81: error: pasting "/* Аналоговый пин ЕС-электрода A*/" and "_Read" does not give a valid preprocessing token

#define EC_APin_A 1 // Аналоговый пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:11:23: note: in definition of macro &#039;_A_Read&#039;

#define _A_Read(x) A##x##_Read

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:113:17: note: in expansion of macro &#039;A_Read&#039;

ec_negative = A_Read(EC_APin_A)+ec_negative;

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:113:24: note: in expansion of macro &#039;EC_APin_A&#039;

ec_negative = A_Read(EC_APin_A)+ec_negative;

^

EC-meter_and_water_leveler:83: error: pasting "/* Цифровой пин ЕС-электрода B*/" and "_Low" does not give a valid preprocessing token

#define EC_DPin_B 11 // Цифровой пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:9:22: note: in definition of macro &#039;_D_Low&#039;

#define _D_Low(x) D##x##_Low

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:114:3: note: in expansion of macro &#039;D_Low&#039;

D_Low(EC_DPin_B);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:114:9: note: in expansion of macro &#039;EC_DPin_B&#039;

D_Low(EC_DPin_B);

^

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_Out" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:5:22: note: in definition of macro &#039;_D_Out&#039;

#define _D_Out(x) D##x##_Out

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:119:1: note: in expansion of macro &#039;D_Out&#039;

D_Out(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:119:7: note: in expansion of macro &#039;EC_DPin_A&#039;

D_Out(EC_DPin_A);

^

EC-meter_and_water_leveler:83: error: pasting "/* Цифровой пин ЕС-электрода B*/" and "_In" does not give a valid preprocessing token

#define EC_DPin_B 11 // Цифровой пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:3:21: note: in definition of macro &#039;_D_In&#039;

#define _D_In(x) D##x##_In

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:120:1: note: in expansion of macro &#039;D_In&#039;

D_In(EC_DPin_B);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:120:6: note: in expansion of macro &#039;EC_DPin_B&#039;

D_In(EC_DPin_B);

^

EC-meter_and_water_leveler:86: error: pasting "/* Цифровой пин электрода уровня*/" and "_Out" does not give a valid preprocessing token

#define Level_DPin_C 2 // Цифровой пин электрода уровня

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:5:22: note: in definition of macro &#039;_D_Out&#039;

#define _D_Out(x) D##x##_Out

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:121:1: note: in expansion of macro &#039;D_Out&#039;

D_Out(Level_DPin_C);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:121:7: note: in expansion of macro &#039;Level_DPin_C&#039;

D_Out(Level_DPin_C);

^

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_High" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:7:23: note: in definition of macro &#039;_D_High&#039;

#define _D_High(x) D##x##_High

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:126:3: note: in expansion of macro &#039;D_High&#039;

D_High(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:126:10: note: in expansion of macro &#039;EC_DPin_A&#039;

D_High(EC_DPin_A);

^

EC-meter_and_water_leveler:81: error: pasting "/* Аналоговый пин ЕС-электрода A*/" and "_Read" does not give a valid preprocessing token

#define EC_APin_A 1 // Аналоговый пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:11:23: note: in definition of macro &#039;_A_Read&#039;

#define _A_Read(x) A##x##_Read

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:127:23: note: in expansion of macro &#039;A_Read&#039;

level_ac_positive = A_Read(EC_APin_A)+level_ac_positive;

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:127:30: note: in expansion of macro &#039;EC_APin_A&#039;

level_ac_positive = A_Read(EC_APin_A)+level_ac_positive;

^

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_Low" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:9:22: note: in definition of macro &#039;_D_Low&#039;

#define _D_Low(x) D##x##_Low

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:128:3: note: in expansion of macro &#039;D_Low&#039;

D_Low(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:128:9: note: in expansion of macro &#039;EC_DPin_A&#039;

D_Low(EC_DPin_A);

^

EC-meter_and_water_leveler:86: error: pasting "/* Цифровой пин электрода уровня*/" and "_High" does not give a valid preprocessing token

#define Level_DPin_C 2 // Цифровой пин электрода уровня

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:7:23: note: in definition of macro &#039;_D_High&#039;

#define _D_High(x) D##x##_High

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:130:3: note: in expansion of macro &#039;D_High&#039;

D_High(Level_DPin_C);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:130:10: note: in expansion of macro &#039;Level_DPin_C&#039;

D_High(Level_DPin_C);

^

EC-meter_and_water_leveler:81: error: pasting "/* Аналоговый пин ЕС-электрода A*/" and "_Read" does not give a valid preprocessing token

#define EC_APin_A 1 // Аналоговый пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:11:23: note: in definition of macro &#039;_A_Read&#039;

#define _A_Read(x) A##x##_Read

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:131:23: note: in expansion of macro &#039;A_Read&#039;

level_ac_negative = A_Read(EC_APin_A)+level_ac_negative;

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:131:30: note: in expansion of macro &#039;EC_APin_A&#039;

level_ac_negative = A_Read(EC_APin_A)+level_ac_negative;

^

EC-meter_and_water_leveler:86: error: pasting "/* Цифровой пин электрода уровня*/" and "_Low" does not give a valid preprocessing token

#define Level_DPin_C 2 // Цифровой пин электрода уровня

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:9:22: note: in definition of macro &#039;_D_Low&#039;

#define _D_Low(x) D##x##_Low

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:132:3: note: in expansion of macro &#039;D_Low&#039;

D_Low(Level_DPin_C);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:132:9: note: in expansion of macro &#039;Level_DPin_C&#039;

D_Low(Level_DPin_C);

^

EC-meter_and_water_leveler:80: error: pasting "/* Цифровой пин ЕС-электрода A*/" and "_In" does not give a valid preprocessing token

#define EC_DPin_A 10 // Цифровой пин ЕС-электрода A

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:3:21: note: in definition of macro &#039;_D_In&#039;

#define _D_In(x) D##x##_In

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:137:1: note: in expansion of macro &#039;D_In&#039;

D_In(EC_DPin_A);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:137:6: note: in expansion of macro &#039;EC_DPin_A&#039;

D_In(EC_DPin_A);

^

EC-meter_and_water_leveler:83: error: pasting "/* Цифровой пин ЕС-электрода B*/" and "_Out" does not give a valid preprocessing token

#define EC_DPin_B 11 // Цифровой пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:5:22: note: in definition of macro &#039;_D_Out&#039;

#define _D_Out(x) D##x##_Out

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:138:1: note: in expansion of macro &#039;D_Out&#039;

D_Out(EC_DPin_B);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:138:7: note: in expansion of macro &#039;EC_DPin_B&#039;

D_Out(EC_DPin_B);

^

EC-meter_and_water_leveler:86: error: pasting "/* Цифровой пин электрода уровня*/" and "_Out" does not give a valid preprocessing token

#define Level_DPin_C 2 // Цифровой пин электрода уровня

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:5:22: note: in definition of macro &#039;_D_Out&#039;

#define _D_Out(x) D##x##_Out

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:139:1: note: in expansion of macro &#039;D_Out&#039;

D_Out(Level_DPin_C);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:139:7: note: in expansion of macro &#039;Level_DPin_C&#039;

D_Out(Level_DPin_C);

^

EC-meter_and_water_leveler:83: error: pasting "/* Цифровой пин ЕС-электрода B*/" and "_High" does not give a valid preprocessing token

#define EC_DPin_B 11 // Цифровой пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:7:23: note: in definition of macro &#039;_D_High&#039;

#define _D_High(x) D##x##_High

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:144:3: note: in expansion of macro &#039;D_High&#039;

D_High(EC_DPin_B);

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:144:10: note: in expansion of macro &#039;EC_DPin_B&#039;

D_High(EC_DPin_B);

^

EC-meter_and_water_leveler:84: error: pasting "/* Аналоговый пин ЕС-электрода B*/" and "_Read" does not give a valid preprocessing token

#define EC_APin_B 0 // Аналоговый пин ЕС-электрода B

^

/Users/alex/Downloads/EC-meter_and_water_leveler/EC-meter_and_water_leveler.ino:11:23: note: in definition of macro &#039;_A_Read&#039;

#define _A_Read(x) A##x##_Read

^

[/code]

и так далее - сюда всё и не влазит

[font=verdana]эт шо как?[/font]


**siv237** 09-07-2017

особенности обработки кода на маке?

А библиотеки нормально подключились?

Тут код, который точно собирается [http://ru.gidroponika.wikia.com/wiki/%D0%98%D0%B7%D0%BC%D0%B5%D1%80%D0%B8%D1%82%D0%B5%D0%BB%D1%8C_EC_%D0%BD%D0%B0_%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%B5_Arduino](http://ru.gidroponika.wikia.com/wiki/%D0%98%D0%B7%D0%BC%D0%B5%D1%80%D0%B8%D1%82%D0%B5%D0%BB%D1%8C_EC_%D0%BD%D0%B0_%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%B5_Arduino){:target="_blank"}

там же нужные библиотеки ссылками.

И кстати, если дойдете до измерения уровня, там еще в процессе отладки алгоритмы. Но главное, площадь проводника для измерения уровня должна быть во много раз больше быть, чем площадь контактов для измерения ЕС.

Лучше намотать проволоку спиралью с равномерным шагом на всю глубину погружения.


**allex_step** 09-07-2017

Мак ни при чем - другие скетчи собираются без проблем

код таки оттуда брал, две библы добавил, остальные уже были (да на библы и не жалуется)

похоже что-то с объявлениями

кстати, про электрод для уровня - Вы бы фотку показали: какой проводник(сечение), на какое сечение оправки намотан, какое расстояние между витками, количество витков...


**siv237** 09-07-2017

> Мак ни при чем - другие скетчи собираются без проблем
> 
> код таки оттуда брал, две библы добавил, остальные уже были (да на библы и не жалуется)
> 
> похоже что-то с объявлениями
> 
> кстати, про электрод для уровня - Вы бы фотку показали: какой проводник(сечение), на какое сечение оправки намотан, какое расстояние между витками, количество витков...

Переключил режим сборки для платы Arduino mega 2560 or Mega ADk и у меня перестало собираться.

У меня есть только arduino uno, возможно не все библиотеки совместимы с мегой.

По измерителю уровня все в стадии отработки и настольных экспериментов. В качестве электрода использую кабель трехжильный АВВГ 3x2,5. Две крайние жилы зачищены на длинну 2 см с расстоянием между ними 5 мм (примерно), средний провод зачищен на всю длинну и обмотан вокруг изоляции кабеля с шагом примерно 1 см. Картинка первого варианта электрода доступна по первой ссылке, правда без намотки.

Стабильность измерений ЕС получается в пределах 0.001 мСи при ЕС меньше 0.5 и ухучшается до 0.01 при ЕС близкое к 5-6 мСи/см

Опыты показали, что чем короче электроды, тем точнее измерения при больших значениях ЕС и тем хуже при низких. Чем ближе электроды друг к другу, тем меньшее влияние оказывает угол расположения их в растворе.


**siv237** 10-07-2017

Вот вариант с использованием всего 1 аналогового входа при этом с учетом поляризации и возможностью измерения уровня.

Без библиотек, потому без измерения температуры. Можете проверить на своей ардуине?

Схема такая D11 соединяем с A0 и с электродом ЕС. D10 соединяем с электродом ЕС. D9 соединяем с электродом уровня.

[code]

void setup() { 

ADCSRA &amp;= B11111000;

ADCSRA = B00000100;

Serial.begin(9600);

}

void loop() {

// Схема подключения

// d1----a1-----&gt;

// d2-----------&gt;

// fConductivity(d1-Цифровой порт соединенный с аналоговым и электродом, d2-Цифровой порт, a1-аналоговый порт, число замеров)

float x0=fConductivity(10,11,0,50000);

// fCalibration(Показания АЦП при низком ЕС, низкое значение ЕС, показания АЦП при высоком ЕС, высокое ЕС, x0)

float ec=fCalibration(20,0.01,350,3,x0);

// Измерение уровня.

float l0=fConductivity(9,11,0,500);

// Отправка в терминал

Serial.print(x0);

Serial.print("\n");

Serial.print(ec,3);

Serial.print("\n");

Serial.print(100-((x0-l0)/x0*100));

Serial.print("\n --------\n");

}

//////////////////////////////////////////////////////////////////////

// ФУНКЦИИ

// Функция калибровки

float fCalibration(float x1, float ec1, float x2, float ec2, float x){

float b=(-log(ec1/ec2))/log(x2/x1);

float a=((pow(x1,-b))*ec1); 

float ec0 = a * pow(x,b);

return ec0;

}

// Функция термокомпенсации ЕС

float fECTemp(float k, float ec0, float t){

return ec0/(1+k*(t-25));

}

//Функция замера электропроводности в RAW

float fConductivity(int d1, int d2, int a1, long cnt){

pinMode(d1, OUTPUT);

pinMode(d2, OUTPUT); 

long var=1;

unsigned long a=0; 

while(var &lt; cnt){

digitalWrite(d1, HIGH);

a=0+analogRead(a1)+a;

digitalWrite(d1, LOW);

digitalWrite(d2, HIGH);

a=1023-analogRead(a1)+a;

digitalWrite(d2, LOW); 

var++;

}

pinMode(d1, INPUT);

pinMode(d2, INPUT);

float b=((float)a/var);

return b;

}

[/code]


**allex_step** 10-07-2017

[size=1em]работает (пины заюзал другие - 7,8,9 соответственно и переназначил как[/size][code] float x0=fConductivity(7,8,A1,50000);

и

float l0=fConductivity(7,9,0,500);[/code]), в консоль выдает в виде[code]2032.63

99.907

52.71

--------

2032.64

99.908

52.76 --------[/code]

[hr]

накопал что скорее всего версии 1.6.5 и ниже должны отрабатывать код, выше уже не работают (что-то поменялось); но и 1.6.5 выдает ошибки[code]Arduino: 1.6.5 (Mac OS X), Board: "Arduino/Genuino Mega or Mega 2560, ATmega2560 (Mega 2560)"

EC-meter_and_liquid_leveler.ino: In function &#039;void loop()&#039;:

EC-meter_and_liquid_leveler:56: error: &#039;class AM2320&#039; has no member named &#039;Read&#039;

EC-meter_and_liquid_leveler:59: error: &#039;class AM2320&#039; has no member named &#039;t&#039;

EC-meter_and_liquid_leveler:61: error: &#039;class AM2320&#039; has no member named &#039;h&#039;

EC-meter_and_liquid_leveler:63: error: &#039;class AM2320&#039; has no member named &#039;t&#039;

EC-meter_and_liquid_leveler:63: error: &#039;class AM2320&#039; has no member named &#039;h&#039;

EC-meter_and_liquid_leveler:67: error: &#039;class AM2320&#039; has no member named &#039;t&#039;

EC-meter_and_liquid_leveler:70: error: &#039;class AM2320&#039; has no member named &#039;h&#039;

EC-meter_and_liquid_leveler:73: error: &#039;class AM2320&#039; has no member named &#039;t&#039;

EC-meter_and_liquid_leveler:73: error: &#039;class AM2320&#039; has no member named &#039;h&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A0_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:108:17: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A1_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:112:17: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A1_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:126:23: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A0_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:144:23: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A3_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:231:17: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A2_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:235:17: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A2_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:249:23: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A3_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:267:23: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A6_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:354:17: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A5_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:358:17: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A5_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:372:23: note: in expansion of macro &#039;A_Read&#039;

EC-meter_and_liquid_leveler:10: error: &#039;A6_Read&#039; was not declared in this scope

EC-meter_and_liquid_leveler.ino:11:19: note: in expansion of macro &#039;_A_Read&#039;

EC-meter_and_liquid_leveler.ino:390:23: note: in expansion of macro &#039;A_Read&#039;

&#039;class AM2320&#039; has no member named &#039;Read&#039;

This report would have more information with

"Show verbose output during compilation"

enabled in File &gt; Preferences.

[/code]

[hr]

таки ошибся - скетч компилится на версии 1.0.6, а на 1.8.3 - тот же мульйон ошибок


**allex_step** 10-07-2017

.


**siv237** 11-07-2017

Уменьшение точности АЦП с переводом на мегагерц позволило значительно повысить число замеров за 1 секунду (20 тыс) даже без использования ускорения работы цифровых за счет побитового включения. При ацп на мегагерц и побитовом включении измерение выполняется с 30 кГц, с традиционным включением через DigitalWrite 20 кГц чего более чем достаточно и при этом есть возможность значительно упростить код вынеся все основные моменты в функции, что легко позволяет прописать несколько измерителей независимо как уровня так и ЕС.

При эускорение АЦП за счет снижения его точности и усреднению 20тыс измерений низкой точности вместо 5 тыс высокой точности, результат не зрительно ухудшился и стабильность в 3 знака после запятой сохранилась.

Потому думаю весь код переписать для совместимости с разными версиями ардуино без использования ускорения работы цифровых портов ограничившись ускорением аналоговых.

А за счет уменьшения числа аналоговых портов для одного комплексного электрода (ЕС+уровень) до одного, возможно одной ардуиной uno измерять 6 растворов одновременно.

Скоро выложу новую схему и универсальный код.


**siv237** 12-07-2017

Изменил программу измерения для повышения универсальности, должно работать на разных вариантах arduino, но надо тестить.

Для измерения ЕС теперь достаточно 1 аналогового и двух цифровых портов и еще один цифровой порт для электрода уровня.

Число измерителей теперь легко добавляется, все типовые вычисления вынесены в функции, а каждый измеритель описывается блоком со списком переменных для калибровки.

Разработал оригинальный метод определения уровня с учетом разной электропроводности раствора. Введен коэффициент коррекции k.

Рассчитывается так:

Измерение проводится на среднем уровне наполнения при высоком и низком ЕС.

ln(x1/x2)/ln(L1/L2)

где x1,x2 - показания RAW электродов ЕС при низком и высоком его значении соответственно

L1,L2 показания RAW электрода уровня при низком и высоком значении ЕС соответственно

Непосредственно перевод уровня в литры требует учитывать форму емкости и потому расчет должен быть индивидуален, возможно добавлю позже, как наберу статистику использования в реальных условиях.

код программы (из библиотек только библиотеки для датчиков температуры и влажности):

[code]

// Библиотека работы с DS18b20

#include &lt;OneWire.h&gt; 

#include &lt;DallasTemperature.h&gt;

#define ONE_WIRE_BUS 12

OneWire oneWire(ONE_WIRE_BUS);

DallasTemperature sensors(&amp;oneWire);

// Библиотека для датчика AM2320

#include &lt;AM2320.h&gt;

#include &lt;Wire.h&gt;

// Глобальные переменные

float po;

float ap_raw;

float an_raw;

void setup() { 

ADCSRA &amp;= B11111000;

ADCSRA = B00000100;

Serial.begin(9600);

Wire.begin();

}

void loop() {

int d1,d2,a1,tr;

long n;

float x,x0,x1,x2,ec,ec0,ec1,ec2,t,tk,k,l,lev;

String gp;

String tstring = "tparse="; // Метка начала строки для парсинга

String tstring_end = "="; // Метка окончания строки

String pstring = ""; // Метка строки вывода колонку 

//////////////////////////////////////////////////////////////////////////

// Общая температура и влажность воздуха с AM2320 через i2c

AM2320 th;

th.Read();

// Заполнение строкового вывода для машинного парсинга

tstring +=fFTS(th.t,1) + ";" + fFTS(th.h,1) + ";" + fFTS(fAbsoluteHumidity(th.t,th.h),1) + ";"; 

// Человекочитаемый вывод

pstring += "Air temperature=";

pstring += fFTS(th.t,2);

pstring += "\n";

pstring += "Relative humidity="; 

pstring += fFTS(th.h,2);

pstring += "\n";

pstring += "Absolute air humidity=";

pstring += fFTS(fAbsoluteHumidity(th.t,th.h),2);

pstring += "\n";

///////////////////////////// Раствор 1 ////////////////////////////////////////////

gp="container 1"; // Номер группы измерения

// Измеритель ЕС1

// Схема подключения

// d1----a1-----&gt;

// d2-----------&gt;

d1=10; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=11; // Цифровой порт соединенный с электродом противофазы

a1=0; // Аналоговый порт измерения

n=50000;// Колличество измерений для усреднения

// Калибровка ЕС

ec1= 0.01; // Фактическое значение ЕС при нижнем пределе

x1=16; // Показания АЦП при нижнем значении ЕС

ec2= 3; // Фактическое значение ЕС при верхнем пределе

x2=160; // Показания АЦП при верхнем значении ЕС

// Температура раствора

tr=0; // Порядковый номер датчика 18b20 в растворе

tk=0.02; // Коэффициент влияния температуры на проводимость раствора

// Измерение температуры

sensors.requestTemperatures(); 

t=sensors.getTempCByIndex(tr);

// Измерение RAW проводимости

x=fConductivity(d1,d2,a1,n);

pstring += gp +" RAW Solution polarization ADC = ";

pstring += fFTS(po,2);

pstring += "\n";

// Расчет ЕС

ec0=fCalibration(x1,ec1,x2,ec2,x);

// Термокомпенсация ЕС

ec=fECTemp(tk,ec0,t);

// Измеритель уровня 1

d1=9; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=11; // Цифровой порт соединенный с электродом противофазы

a1=0; // Аналоговый порт измерения

n=500; // Колличество измерений для усреднения

k=0.835; // Коэффициент компенсации электропроводности

// Измерение проводимости

l=fConductivity(d1,d2,a1,n); 

lev=x/pow(l,k);

// Заполнение строкового вывода для машинного парсинга

tstring +=fFTS(t,2) + ";" + fFTS(x,4) + ";" + fFTS(l,2) + ";"+ fFTS(ec0,4) + ";"; 

// Человекочитаемый вывод 

pstring += gp +" Solution temperature = ";

pstring += fFTS(t,2);

pstring += "\n";

pstring += gp +" RAW EC ADC = ";

pstring += fFTS(x,4);

pstring += "\n"; 

pstring += gp +" RAW Level ADC = ";

pstring += fFTS(l,2);

pstring += "\n"; 

pstring += gp +" EC = ";

pstring += fFTS(ec0,4);

pstring += "\n";

pstring += gp +" Level = ";

pstring += fFTS(lev,4);

pstring += "\n";

/////////////////////////////////////////////////////////////////////////////////////

///////////////////////////// Раствор 2 ////////////////////////////////////////////

gp="container 2"; // Номер группы измерения

// Измеритель ЕС 2

// Схема подключения

// d1----a1-----&gt;

// d2-----------&gt;

d1=7; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=8; // Цифровой порт соединенный с электродом противофазы

a1=1; // Аналоговый порт измерения

n=50000;// Колличество измерений для усреднения

// Калибровка ЕС

ec1= 0.01; // Фактическое значение ЕС при нижнем пределе

x1=16; // Показания АЦП при нижнем значении ЕС

ec2= 3; // Фактическое значение ЕС при верхнем пределе

x2=160; // Показания АЦП при верхнем значении ЕС

// Температура раствора

tr=1; // Порядковый номер датчика 18b20 в растворе

tk=0.02; // Коэффициент влияния температуры на проводимость раствора

// Измерение температуры

sensors.requestTemperatures(); 

t=sensors.getTempCByIndex(tr);

// Измерение RAW проводимости

x=fConductivity(d1,d2,a1,n);

pstring += gp +" RAW Solution polarization ADC = ";

pstring += fFTS(po,2);

pstring += "\n";

// Расчет ЕС

ec0=fCalibration(x1,ec1,x2,ec2,x);

// Термокомпенсация ЕС

ec=fECTemp(tk,ec0,t);

// Измеритель уровня 2

d1=6; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=8; // Цифровой порт соединенный с электродом противофазы

a1=1; // Аналоговый порт измерения

n=500; // Колличество измерений для усреднения

k=0.835; // Коэффициент компенсации электропроводности

// Измерение проводимости

l=fConductivity(d1,d2,a1,n); 

lev=x/pow(l,k);

// Заполнение строкового вывода для машинного парсинга

tstring +=fFTS(t,2) + ";" + fFTS(x,4) + ";" + fFTS(l,2) + ";"+ fFTS(ec0,4) + ";"; 

// Человекочитаемый вывод 

pstring += gp +" Solution temperature = ";

pstring += fFTS(t,2);

pstring += "\n";

pstring += gp +" RAW EC ADC = ";

pstring += fFTS(x,4);

pstring += "\n"; 

pstring += gp +" RAW Level ADC = ";

pstring += fFTS(l,2);

pstring += "\n"; 

pstring += gp +" EC = ";

pstring += fFTS(ec0,4);

pstring += "\n";

pstring += gp +" Level = ";

pstring += fFTS(lev,4);

pstring += "\n";

/////////////////////////////////////////////////////////////////////////////////////

// Передача в терминал

tstring += tstring_end;

Serial.println(tstring);

Serial.print("\n");

Serial.print(pstring);

Serial.print("\n --------\n");

}

//////////////////////////////////////////////////////////////////////

// ФУНКЦИИ

// Функция калибровки

float fCalibration(float x1, float ec1, float x2, float ec2, float x){

float b=(-log(ec1/ec2))/log(x2/x1);

float a=((pow(x1,-b))*ec1); 

float ec0 = a * pow(x,b);

return ec0;

}

// Функция термокомпенсации ЕС

float fECTemp(float k, float ec0, float t){

return ec0/(1+k*(t-25));

}

//Функция замера электропроводности в RAW

float fConductivity(int d1, int d2, int a1, long cnt){

pinMode(d1, OUTPUT);

pinMode(d2, OUTPUT); 

long var=1;

unsigned long ap=0;

unsigned long an=0; 

while(var &lt; cnt){

digitalWrite(d1, HIGH);

ap=0+analogRead(a1)+ap;

digitalWrite(d1, LOW);

digitalWrite(d2, HIGH);

an=1023-analogRead(a1)+an;

digitalWrite(d2, LOW); 

var++;

}

pinMode(d1, INPUT);

pinMode(d2, INPUT);

// Усреднение АЦП при положительной фазе

ap_raw=(float)ap/var;

// Усреднение АЦП при отрицательной фазе

an_raw=(float)an/var;

// Расчет поляризации раствора 

po = ap_raw-an_raw;

// Исключение влияние поляризаци

return (((float)ap+(float)an)/var/2);

}

// Функция преобразования чисел с плавающей запятой в текст 

String fFTS(float x, byte precision) {

char tmp[50];

dtostrf(x, 0, precision, tmp);

return String(tmp);

}

// Функция конвертации относительной влажности в абсолютную

float fAbsoluteHumidity(float tt, float rh){

return (4.579*pow(2.71828,((17.14*tt)/(235.3+tt))))*rh/100;

}

[/code]


**allex_step** 12-07-2017

> Arduino: 1.8.3 (Mac OS X), Board: "Arduino/Genuino Mega or Mega 2560, ATmega2560 (Mega 2560)"
> 
> /Users/alex/Documents/Arduino/sketch_jul12a/sketch_jul12a.ino: In function &#039;void loop()&#039;:
> 
> sketch_jul12a:36: error: &#039;class AM2320&#039; has no member named &#039;Read&#039;
> 
> th.Read();
> 
> ^
> 
> sketch_jul12a:38: error: &#039;class AM2320&#039; has no member named &#039;t&#039;
> 
> tstring +=fFTS(th.t,1) + ";" + fFTS(th.h,1) + ";" + fFTS(fAbsoluteHumidity(th.t,th.h),1) + ";"; 
> 
> ^
> 
> sketch_jul12a:38: error: &#039;class AM2320&#039; has no member named &#039;h&#039;
> 
> tstring +=fFTS(th.t,1) + ";" + fFTS(th.h,1) + ";" + fFTS(fAbsoluteHumidity(th.t,th.h),1) + ";"; 
> 
> ^
> 
> sketch_jul12a:38: error: &#039;class AM2320&#039; has no member named &#039;t&#039;
> 
> tstring +=fFTS(th.t,1) + ";" + fFTS(th.h,1) + ";" + fFTS(fAbsoluteHumidity(th.t,th.h),1) + ";"; 
> 
> ^
> 
> sketch_jul12a:38: error: &#039;class AM2320&#039; has no member named &#039;h&#039;
> 
> tstring +=fFTS(th.t,1) + ";" + fFTS(th.h,1) + ";" + fFTS(fAbsoluteHumidity(th.t,th.h),1) + ";"; 
> 
> ^
> 
> sketch_jul12a:41: error: &#039;class AM2320&#039; has no member named &#039;t&#039;
> 
> pstring += fFTS(th.t,2);
> 
> ^
> 
> sketch_jul12a:44: error: &#039;class AM2320&#039; has no member named &#039;h&#039;
> 
> pstring += fFTS(th.h,2);
> 
> ^
> 
> sketch_jul12a:47: error: &#039;class AM2320&#039; has no member named &#039;t&#039;
> 
> pstring += fFTS(fAbsoluteHumidity(th.t,th.h),2);
> 
> ^
> 
> sketch_jul12a:47: error: &#039;class AM2320&#039; has no member named &#039;h&#039;
> 
> pstring += fFTS(fAbsoluteHumidity(th.t,th.h),2);
> 
> ^
> 
> exit status 1
> 
> &#039;class AM2320&#039; has no member named &#039;Read&#039;
> 
> This report would have more information with
> 
> "Show verbose output during compilation"
> 
> option enabled in File -&gt; Preferences.

кстати, можно DHT22 (AM2302) заюзать вместо AM2320?


**siv237** 12-07-2017

Ну логично, библиотека для 2320 не подключена. Можно закоментить.

Использовать DHT22 можно но я не пробовал его еще на ардуине.

Выкладываю только то, что у меня работает.

Вообще блок работы с датчиком общей влажности и температуры не важен для задачи расчета ЕС. Для неё нужны датчики 18b20 в растворе. Так, что можно комментить либу и весь блок измерения воздуха.


**allex_step** 12-07-2017

как так не подключена???![](http://i.piccy.info/i9/9ee7afe3e87c9fa0b7657ee58c5c4672/1499881021/206141/1149857/Screen_Shot_2017_07_12_at_20_36_31.png)![](http://i.piccy.info/a3/2017-07-12-17-37/i9-11371600/528x697-r/i.gif)


**siv237** 12-07-2017

Вот убрал этот злосчастный датчик :). Попробуйте такой код.

[code]

// Библиотека работы с DS18b20

#include &lt;OneWire.h&gt; 

#include &lt;DallasTemperature.h&gt;

#define ONE_WIRE_BUS 12

OneWire oneWire(ONE_WIRE_BUS);

DallasTemperature sensors(&amp;oneWire);

// Глобальные переменные

float po;

float ap_raw;

float an_raw;

void setup() { 

ADCSRA &amp;= B11111000;

ADCSRA = B00000100;

Serial.begin(9600);

}

void loop() {

int d1,d2,a1,tr;

long n;

float x,x0,x1,x2,ec,ec0,ec1,ec2,t,tk,k,l,lev;

String gp;

String tstring = "tparse="; // Метка начала строки для парсинга

String tstring_end = "="; // Метка окончания строки

String pstring = ""; // Метка строки вывода колонку 

//////////////////////////////////////////////////////////////////////////

///////////////////////////// Раствор 1 ////////////////////////////////////////////

gp="container 1"; // Номер группы измерения

// Измеритель ЕС1

// Схема подключения

// d1----a1-----&gt;

// d2-----------&gt;

d1=10; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=11; // Цифровой порт соединенный с электродом противофазы

a1=0; // Аналоговый порт измерения

n=50000;// Колличество измерений для усреднения

// Калибровка ЕС

ec1= 0.01; // Фактическое значение ЕС при нижнем пределе

x1=16; // Показания АЦП при нижнем значении ЕС

ec2= 3; // Фактическое значение ЕС при верхнем пределе

x2=160; // Показания АЦП при верхнем значении ЕС

// Температура раствора

tr=0; // Порядковый номер датчика 18b20 в растворе

tk=0.02; // Коэффициент влияния температуры на проводимость раствора

// Измерение температуры

sensors.requestTemperatures(); 

t=sensors.getTempCByIndex(tr);

// Измерение RAW проводимости

x=fConductivity(d1,d2,a1,n);

pstring += gp +" RAW Solution polarization ADC = ";

pstring += fFTS(po,2);

pstring += "\n";

// Расчет ЕС

ec0=fCalibration(x1,ec1,x2,ec2,x);

// Термокомпенсация ЕС

ec=fECTemp(tk,ec0,t);

// Измеритель уровня 1

d1=9; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=11; // Цифровой порт соединенный с электродом противофазы

a1=0; // Аналоговый порт измерения

n=500; // Колличество измерений для усреднения

k=0.835; // Коэффициент компенсации электропроводности

// Измерение проводимости

l=fConductivity(d1,d2,a1,n); 

lev=x/pow(l,k);

// Заполнение строкового вывода для машинного парсинга

tstring +=fFTS(t,2) + ";" + fFTS(x,4) + ";" + fFTS(l,2) + ";"+ fFTS(ec0,4) + ";"; 

// Человекочитаемый вывод 

pstring += gp +" Solution temperature = ";

pstring += fFTS(t,2);

pstring += "\n";

pstring += gp +" RAW EC ADC = ";

pstring += fFTS(x,4);

pstring += "\n"; 

pstring += gp +" RAW Level ADC = ";

pstring += fFTS(l,2);

pstring += "\n"; 

pstring += gp +" EC = ";

pstring += fFTS(ec0,4);

pstring += "\n";

pstring += gp +" Level = ";

pstring += fFTS(lev,4);

pstring += "\n";

/////////////////////////////////////////////////////////////////////////////////////

///////////////////////////// Раствор 2 ////////////////////////////////////////////

gp="container 2"; // Номер группы измерения

// Измеритель ЕС 2

// Схема подключения

// d1----a1-----&gt;

// d2-----------&gt;

d1=7; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=8; // Цифровой порт соединенный с электродом противофазы

a1=1; // Аналоговый порт измерения

n=50000;// Колличество измерений для усреднения

// Калибровка ЕС

ec1= 0.01; // Фактическое значение ЕС при нижнем пределе

x1=16; // Показания АЦП при нижнем значении ЕС

ec2= 3; // Фактическое значение ЕС при верхнем пределе

x2=160; // Показания АЦП при верхнем значении ЕС

// Температура раствора

tr=1; // Порядковый номер датчика 18b20 в растворе

tk=0.02; // Коэффициент влияния температуры на проводимость раствора

// Измерение температуры

sensors.requestTemperatures(); 

t=sensors.getTempCByIndex(tr);

// Измерение RAW проводимости

x=fConductivity(d1,d2,a1,n);

pstring += gp +" RAW Solution polarization ADC = ";

pstring += fFTS(po,2);

pstring += "\n";

// Расчет ЕС

ec0=fCalibration(x1,ec1,x2,ec2,x);

// Термокомпенсация ЕС

ec=fECTemp(tk,ec0,t);

// Измеритель уровня 2

d1=6; // Цифровой порт соединенный с аналоговым портом и электродом измерения

d2=8; // Цифровой порт соединенный с электродом противофазы

a1=1; // Аналоговый порт измерения

n=500; // Колличество измерений для усреднения

k=0.835; // Коэффициент компенсации электропроводности

// Измерение проводимости

l=fConductivity(d1,d2,a1,n); 

lev=x/pow(l,k);

// Заполнение строкового вывода для машинного парсинга

tstring +=fFTS(t,2) + ";" + fFTS(x,4) + ";" + fFTS(l,2) + ";"+ fFTS(ec0,4) + ";"; 

// Человекочитаемый вывод 

pstring += gp +" Solution temperature = ";

pstring += fFTS(t,2);

pstring += "\n";

pstring += gp +" RAW EC ADC = ";

pstring += fFTS(x,4);

pstring += "\n"; 

pstring += gp +" RAW Level ADC = ";

pstring += fFTS(l,2);

pstring += "\n"; 

pstring += gp +" EC = ";

pstring += fFTS(ec0,4);

pstring += "\n";

pstring += gp +" Level = ";

pstring += fFTS(lev,4);

pstring += "\n";

/////////////////////////////////////////////////////////////////////////////////////

// Передача в терминал

tstring += tstring_end;

Serial.println(tstring);

Serial.print("\n");

Serial.print(pstring);

Serial.print("\n --------\n");

}

//////////////////////////////////////////////////////////////////////

// ФУНКЦИИ

// Функция калибровки

float fCalibration(float x1, float ec1, float x2, float ec2, float x){

float b=(-log(ec1/ec2))/log(x2/x1);

float a=((pow(x1,-b))*ec1); 

float ec0 = a * pow(x,b);

return ec0;

}

// Функция термокомпенсации ЕС

float fECTemp(float k, float ec0, float t){

return ec0/(1+k*(t-25));

}

//Функция замера электропроводности в RAW

float fConductivity(int d1, int d2, int a1, long cnt){

pinMode(d1, OUTPUT);

pinMode(d2, OUTPUT); 

long var=1;

unsigned long ap=0;

unsigned long an=0; 

while(var &lt; cnt){

digitalWrite(d1, HIGH);

ap=0+analogRead(a1)+ap;

digitalWrite(d1, LOW);

digitalWrite(d2, HIGH);

an=1023-analogRead(a1)+an;

digitalWrite(d2, LOW); 

var++;

}

pinMode(d1, INPUT);

pinMode(d2, INPUT);

// Усреднение АЦП при положительной фазе

ap_raw=(float)ap/var;

// Усреднение АЦП при отрицательной фазе

an_raw=(float)an/var;

// Расчет поляризации раствора 

po = ap_raw-an_raw;

// Исключение влияние поляризаци

return (((float)ap+(float)an)/var/2);

}

// Функция преобразования чисел с плавающей запятой в текст 

String fFTS(float x, byte precision) {

char tmp[50];

dtostrf(x, 0, precision, tmp);

return String(tmp);

}

// Функция конвертации относительной влажности в абсолютную

float fAbsoluteHumidity(float tt, float rh){

return (4.579*pow(2.71828,((17.14*tt)/(235.3+tt))))*rh/100;

}

[/code]


**allex_step** 13-07-2017

> Arduino: 1.8.3 (Mac OS X), Board: "Arduino/Genuino Mega or Mega 2560, ATmega2560 (Mega 2560)"
> 
> sketch_jul13a:229: error: redefinition of &#039;OneWire oneWire&#039;
> 
> OneWire oneWire(ONE_WIRE_BUS);
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:5:9: note: &#039;OneWire oneWire&#039; previously declared here
> 
> OneWire oneWire(ONE_WIRE_BUS);
> 
> ^
> 
> sketch_jul13a:230: error: redefinition of &#039;DallasTemperature sensors&#039;
> 
> DallasTemperature sensors(&amp;oneWire);
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:6:19: note: &#039;DallasTemperature sensors&#039; previously declared here
> 
> DallasTemperature sensors(&amp;oneWire);
> 
> ^
> 
> sketch_jul13a:232: error: redefinition of &#039;float po&#039;
> 
> float po;
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:8:7: note: &#039;float po&#039; previously declared here
> 
> float po;
> 
> ^
> 
> sketch_jul13a:233: error: redefinition of &#039;float ap_raw&#039;
> 
> float ap_raw;
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:9:7: note: &#039;float ap_raw&#039; previously declared here
> 
> float ap_raw;
> 
> ^
> 
> sketch_jul13a:234: error: redefinition of &#039;float an_raw&#039;
> 
> float an_raw;
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:10:7: note: &#039;float an_raw&#039; previously declared here
> 
> float an_raw;
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;void setup()&#039;:
> 
> sketch_jul13a:236: error: redefinition of &#039;void setup()&#039;
> 
> void setup() { 
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:12:6: note: &#039;void setup()&#039; previously defined here
> 
> void setup() { 
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;void loop()&#039;:
> 
> sketch_jul13a:243: error: redefinition of &#039;void loop()&#039;
> 
> void loop() {
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:19:6: note: &#039;void loop()&#039; previously defined here
> 
> void loop() {
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;float fCalibration(float, float, float, float, float)&#039;:
> 
> sketch_jul13a:393: error: redefinition of &#039;float fCalibration(float, float, float, float, float)&#039;
> 
> float fCalibration(float x1, float ec1, float x2, float ec2, float x){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:169:7: note: &#039;float fCalibration(float, float, float, float, float)&#039; previously defined here
> 
> float fCalibration(float x1, float ec1, float x2, float ec2, float x){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;float fECTemp(float, float, float)&#039;:
> 
> sketch_jul13a:401: error: redefinition of &#039;float fECTemp(float, float, float)&#039;
> 
> float fECTemp(float k, float ec0, float t){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:177:7: note: &#039;float fECTemp(float, float, float)&#039; previously defined here
> 
> float fECTemp(float k, float ec0, float t){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;float fConductivity(int, int, int, long int)&#039;:
> 
> sketch_jul13a:406: error: redefinition of &#039;float fConductivity(int, int, int, long int)&#039;
> 
> float fConductivity(int d1, int d2, int a1, long cnt){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:182:7: note: &#039;float fConductivity(int, int, int, long int)&#039; previously defined here
> 
> float fConductivity(int d1, int d2, int a1, long cnt){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;String fFTS(float, byte)&#039;:
> 
> sketch_jul13a:438: error: redefinition of &#039;String fFTS(float, byte)&#039;
> 
> String fFTS(float x, byte precision) {
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:214:8: note: &#039;String fFTS(float, byte)&#039; previously defined here
> 
> String fFTS(float x, byte precision) {
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino: In function &#039;float fAbsoluteHumidity(float, float)&#039;:
> 
> sketch_jul13a:446: error: redefinition of &#039;float fAbsoluteHumidity(float, float)&#039;
> 
> float fAbsoluteHumidity(float tt, float rh){
> 
> ^
> 
> /Users/alex/Documents/Arduino/sketch_jul13a/sketch_jul13a.ino:222:7: note: &#039;float fAbsoluteHumidity(float, float)&#039; previously defined here
> 
> float fAbsoluteHumidity(float tt, float rh){
> 
> ^
> 
> exit status 1
> 
> redefinition of &#039;OneWire oneWire&#039;
> 
> This report would have more information with
> 
> "Show verbose output during compilation"
> 
> option enabled in File -&gt; Preferences.



**siv237** 13-07-2017

Вот специально проверил этот код для меги. Все компилится с копипасты из предыдущего сообщения.

[![](/imagehost2/thumbs/20170714081830.png)](https://t.me/ponics_ru_files/18546){:target="_blank"}

Почему у вас пишет про повторные объявления, так, как будто вы два раза вставили текст скетча в одно окно?


**allex_step** 13-07-2017

ну вот! по скрину явно видна причина!

все дело в версии Arduino IDE...

после 1.6.5 она стала слишком "умная" (типа некоторых тут коллег) - балуется-психует по чем ни зря

в 1.0.6 и у меня скомпилилось при тех же библиотеках

![](http://i.piccy.info/i9/1b32aab2ad7dd994e7cb4bf47e519957/1499987139/35761/1149857/Screen_Shot_2017_07_14_at_02_05_03_500.jpg)![](http://i.piccy.info/a3/2017-07-13-23-05/i9-11375208/373x448-r/i.gif)

а почему размер итогового бинарника разный..? :-\ :o 


**serge mat** 14-10-2017

> Насколько я понял перелопатив литературу по защите алюминиевых конструкций в агрессивных средах, алюминий металлический устойчив в расторах наших солей благодаря оксидной пленке. Проблемы могут быть из-за наличия NH4.
> 
> Но все меняется при протекании постоянного электрического тока. Гальванический перенос может идти довольно активно. Провел опыт на ночь запитал 5 вольтами в растворе хлорида натрия. Утром 1 электрод покрылся толстой шапкой белого налета по ощущениям состоящей из твердых фракций, а второй черновато серой гадостью и электрод полностью стал хрупким и рассыпался в руках. Это за ночь.
> 
> Именно по этому для сохранности электродов и препятствования их взаимодействия с раствором требуется обеспечивать высокую частоту смены полярности электродов. Тогда грубо говоря ионы не успевают доплыть от одного электрода к другому и прореагировать, так как постянно меняют свое направление. А перенос идет заряда идет за счет выстраивания их в цепочку принципом вагончиков. Толкаем задний двигается передний и наоборот.

Может быть таким образом мы сможем сохранить алюминий. Но сохраним ли мы раствор? Дело в том, что в нашем растворе есть металлы менее активные и при первой возможности они поменяются с алюминием местами, то есть осядут на электроде, а алюминий пойдет в раствор. Это прежде всего медь, но также марганец и железо. Мы их будем терять.

Далее, нам нужны непрерывные измерения, значит ардуинка целиком отдается этой одной задаче. Значит, для других целей автоматизации нужна другая ардуинка. Не слишком ли дорого обойдется такой "бесплатный" вариант? Может проще купить готовые ЕС-датчик?

> Кроме того, приложенный переменный электрический потенциал снижает разрушение алюминиевых конструкций даже в сравнении с конструкциями к которым потенциал не приложен. 
> 
> Если я правильно понял принцип, то постоянно меня местами анод и катод можно значительно повысить сохранность алюминия в агрессивных средах, что используют в промышленности и кораблестроении.
> 
> Потому я реализовал принцип непрерывного, а не периодического измерения, что-бы не оставлять электроды без приложенных потенциалов.
> 
> Ну и алюминий считается относительно безопасным для растений и для здоровья человека. Его вообще если я не ошибаюсь любой в земле огромное количество вроде 3й по распространенности металл на земле.

Давайте вернемся к пассажу с платиной. Может быть платина в самом деле была бы идеальным электродом, но если не она, то почему сразу алюминий? Давайте посмотрим на школьную табличку "Ряд напряжений металлов". Во-первых крайней справа там не платина, а золото. В отличии от платины, образцы золота есть в доступе, я думаю, у каждого. А если учесть, что золото очень пассивно и, значит, с ним ничего не случится, то можно взять какую-нибудь побрякушку во временное пользование.

> К меди отношусь очень с подозрением. Слишком она хорошо окисляется сама по себе в растворе. Просто кусок проволоки в бутылке с раствором становится черным через сутки, при этом при протирании остается зеленый осадок. К проводу никаких потенциалов не было приложено просто случайно упал.

Да, согласен, медь окисляется кислородом, даже если она в воде. Растворенный кислород нам нужен, значит медь будет окисляться. Но может быть медленнее, чем алюминий? Если к ней приложить те же самые условия. И уж точно медь не вытеснит из раствора другие элементы, ибо она самый пассивный металл из присутствующих в растворе.

Далее. Есть еще серебро. Это уже и вовсе металл доступный, его даже купить можно для нашей цели. Например пару десертных ложечек. А когда набалуемся, то использовать в хозяйстве как ложки...

Серебро чернеет от серы в восстановительной среде. Поскольку мы следим за доступом воздуха, то среда в нашем растворе должна оставаться окислительной, а значит серебру ничего не должно сделаться.

Ну и еще более реальный вариант - посеребренный медный провод.

Если электроды смогут спокойно находиться в растворе, то мы сможем делать измерения не непрерывно, а, например, раз в час. А в остальное время ардуинка будет следить за массой других параметров. Разве это не лучше?


**vladindre** 14-10-2017

> Есть еще серебро

Серебро вообще не прокатит. При электролизе оно очень активно переходит в раствор. Его хорошо видно -- этакая туманная масса. Иногда у себя дома наблюдаю при приготовлении серебряной воды для лечебных целей. Процесс давно известный и используется на практике.

Сомнительно , что такой обильный туман пойдет на пользу растениям. Наверняка начнет с чем-нибудь реагировать и не в лучшую сторону. По крайней мере никогда не слышал о влиянии серебра на растения.


**Vad** 14-10-2017

серебро это очень мощный антисептик..

растения вымрут.. :D

они не любят.. когда их травят))

по поводу приготовления живой - мертвой воды..

Ионы серебра обладают бактериостатическими свойствами. Однако для достижения бактериостатического эффекта концентрацию ионов серебра в воде необходимо повысить настолько, что она становится непригодной для питья. Бактериостатические свойства серебра известны с древности. 2500 лет назад персидский царь Кир II Великий в своих военных походах использовал серебряные сосуды для хранения воды. Покрытие поверхностных ран серебряными пластинами практиковалось ещё в древнем Египте. Очистку больших количеств воды, основанную на бактерицидном действии серебра, особенно удобно производить электрохимическим путём[11].

В начале 1970-х нижний предел бактериостатического действия серебра оценивался содержанием его в воде порядка 1 мкг/л[11]. По данным 2009 года — нижний предел действия находится на уровне 50—300 мкг/л[9], что уже опасно для человека.

Как и все тяжёлые металлы, серебро при избыточном поступлении в организм токсично[11].

По санитарным нормам США содержание серебра в питьевой воде не должно превышать 0,05 мг/л.


**allex_step** 14-10-2017

del


**PAA** 14-10-2017

..."Давайте вернемся к пассажу с платиной. Может быть платина в самом деле была бы идеальным электродом, но если не она, то почему сразу алюминий?"...

Кое кто довольно успешно использует графитовые электроды - обычные стержни от простого карандаша. Даже растворяясь в воде, графит не будет влиять на свойства раствора (ИМХО). Графит стоек к окислению (при обычной температуре), не вступает в реакцию не с солями, не с кислотами и щелочами. Про доступность и стоимость - вообще молчу. Во всяком случае я для себя буду делать ЕС метр на графите, ну и еще попробую четырехэлектродный метод.


**Vad** 14-10-2017

грифель пропитан парафином(как связующим)

допустим, мы можем извлечь его выжиганием, но в грифеле есть еще связующие.. получается.. чепуха.. или пальцем не тронь - рассыпается..

все это мы проходили.. давно..

единственный более-менее рабочий вариант - нержавейка с большим содержанием хрома... (которая не паяется.. и плохо липнет к магниту) 


**allex_step** 14-10-2017

а графитовый стержень из солевой батарейки?..


**serge mat** 14-10-2017

> грифель пропитан парафином(как связующим)
> 
> допустим, мы можем извлечь его выжиганием, но в грифеле есть еще связующие.. получается.. чепуха.. или пальцем не тронь - рассыпается..
> 
> все это мы проходили.. давно..
> 
> единственный более-менее рабочий вариант - нержавейка с большим содержанием хрома... (которая не паяется.. и плохо липнет к магниту)

Парафин вовсе не мешает. Если грифель карандаша проводит электричество, то он подходит


**allex_step** 14-10-2017

[www.youtube.com/watch?v=zNrDxiGMa0U](http://forum.ponics.ru/go.php?url=aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj16TnJEeGlHTWEwVQ==){:target="_blank"}

теперь в канцелярию за карандашами только с мультиметром?.. *crazy* :D 

> [font=Verdana]Во всяком случае я для себя буду делать ЕС метр на графите[/font]

[font=Verdana]держите нас в курсе - тоже интересно [/font] ;) 


**serge mat** 14-10-2017

> Кое кто довольно успешно использует графитовые электроды - обычные стержни от простого карандаша. Даже растворяясь в воде, графит не будет влиять на свойства раствора (ИМХО). Графит стоек к окислению (при обычной температуре), не вступает в реакцию не с солями, не с кислотами и щелочами. Про доступность и стоимость - вообще молчу. Во всяком случае я для себя буду делать ЕС метр на графите, ну и еще попробую четырехэлектродный метод.

Тут единственное что вызывает сомнения, это сопротивление графита. Все таки графит не металл, его сопротивлением пренебречь не получится. Если окажется, что его сопротивление сильно больше сопротивления раствора, то мы потеряем в точности.


**serge mat** 14-10-2017

> [www.youtube.com/watch?v=zNrDxiGMa0U](http://forum.ponics.ru/go.php?url=aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj16TnJEeGlHTWEwVQ==){:target="_blank"}
> 
> теперь в канцелярию за карандашами только с мультиметром?.. *crazy* :D 
> 
> 
> > [font=Verdana]Во всяком случае я для себя буду делать ЕС метр на графите[/font]
> 
> [font=Verdana]держите нас в курсе - тоже интересно [/font] ;)

В советское время грифели различались по твердости от 3Т до 3М. Чем тверже грифель, тем меньше в нем глины. Глина добавляется собственно для мягкости.


**allex_step** 14-10-2017

> Тут единственное что вызывает сомнения, это сопротивление графита. Все таки графит не металл, его сопротивлением пренебречь не получится. Если окажется, что его сопротивление сильно больше сопротивления раствора, то мы потеряем в точности.

вроде как на видео (выше) намеряли сопротивление графита в карандаше порядка 0,04 Ом, а из солевой батарейки порядка 0,01 Ом (кагбэ и диаметр роль играет)


**Vad** 14-10-2017

> Парафин вовсе не мешает. Если грифель карандаша проводит электричество, то он подходит

ню-ню :)

калибровка при каждом прикосновении..

нормальное развлечение *8)*


**allex_step** 14-10-2017

так может все таки такой вариант лучше использовать?

![](https://ua.all.biz/img/ua/catalog/439166.jpeg)


**siv237** 15-10-2017

Для себя я тему с измерением ЕС и подбором материала и источника электродов закрыл. Алюминиевый провод из куска АВВГ кабеля и прямой опрос с частотой 40 кГц оказался просто идеальным решением для гидропоники. Даже специализированный электрод из нержавеющей стали убрал и заменил АВВГ и получил значительно более ровный стабильный график.

Можно спорить, доказывать, сражаться и быть не согласным, но для меня фактический результат важнее рассуждений.

Точность измерений выше, чем 0.001 (за счет усреднения 40 тыс замеров. за секунду)

Выше были вопросы про температуру, так вот температура влияет и на графиках отлично видна зависимость. При такой точности даже взаимное расположение датчика ЕС и температурного датчика оказывают влияния на показания.

Стабильность алюминиевого электрода выше всяческих похвал, я думал буду просто заменять их переодически зачищая новый участок провода, но даже этого не потребовалось. Ухода в измерениях или зрительного помутнения контактов так и не произошло с момента начала измерений.

Одна ардуина нано (90 руб) может обеспечить (если не использовать i2c шину) 8 независимых измерителей ЕС и уровня.

Считаю вопрос с простым устройством, которое может повторить любой гидропонщик решен окончательно. Никаких резисторов и прочих мудреных схем не нужно. Кусок провода и ардуина и датчик температуры в водозащитном корпусе, больше ничего не нужно.

У меня сейчас успешно работает система измеряющая не просто ЕС но и уровень раствора одним куском провода (3 проводника). Правда к методике расчета уровня раствора у меня все еще есть претензии и основная заключается в том, что чем более значительная разница в площадях контактов ЕС измерителя и контакта измерителя уровня тем меньшее влияние дает дальнейшее увеличение этой разницы. Таким образом, пока уровень затопления электрода уровня максимальный, то точность измерения низкая. Чем меньше остается раствора, тем более значительно возрастает точность.

Потому перевести в реальные литры на глубоком баке не получилось, вернее получилось более менее точно при объеме меньше половины, при этом измерение уровня 17 литрового таза работало достаточно точно. 

Таким образом измерение уровня в глубоких баках точнее получается ультразвуком, в мелких кондуктометрическим методом.


**vladindre** 15-10-2017

> Алюминиевый провод из куска АВВГ кабеля и прямой опрос с частотой 40 кГц оказался просто идеальным решением для гидропоники.

Возможно алюминий и подойдет за счет наличия оксида на поверхности и будет достаточно инертным. Не пробовал. Есть только мысли по нем. Нержавейка тоже сомнительна. Если она " не ржавеет ", то не факт , что не будет выделять в раствор никель и хром.

Наилучший вариант - использование графитных щеток. Для себя так определился. Это железно надежный и абсолютно инертный вариант. Только надо использовать чисто графитные щетки марки Г. Большинство применяемых щеток сейчас меднографитные МГ с большим количеством меди. Наверху на фото марка МГ. Явно виден красноватый цвет.

Пару щеток думаю сгруппировать в блок с расстоянием в несколько мм , а верх с отводами залить эпоксидом для исключения контакта с раствором и одновременно получается сформированный датчик как конструктивная единица. Ну детали изготовления каждый сможет додумать сам исходя из своих возможностей и наличия всякого другого у себя.


**serge mat** 15-10-2017

> Можно спорить, доказывать, сражаться и быть не согласным, но для меня фактический результат важнее рассуждений.
> 
> Точность измерений выше, чем 0.001 (за счет усреднения 40 тыс замеров. за секунду)

Хорошо, точность измерений есть. А что с составом раствора? Можно ли утверждать, что все микроэлементы остались на месте?

> Выше были вопросы про температуру, так вот температура влияет и на графиках отлично видна зависимость. При такой точности даже взаимное расположение датчика ЕС и температурного датчика оказывают влияния на показания.

Это можно отдельно обсудить. Как должен располагаться температурный датчик?

> Одна ардуина нано (90 руб) может обеспечить (если не использовать i2c шину) 8 независимых измерителей ЕС и уровня.
> 
> Считаю вопрос с простым устройством, которое может повторить любой гидропонщик решен окончательно. Никаких резисторов и прочих мудреных схем не нужно. Кусок провода и ардуина и датчик температуры в водозащитном корпусе, больше ничего не нужно.

Но если мне нужно не 8 независисмых ЕС, а управлять насосами и освещением, следить за влажностью воздуха... Вы предлагаете для этого другую ардуину использовать, или же эта сможет?

> У меня сейчас успешно работает система измеряющая не просто ЕС но и уровень раствора одним куском провода (3 проводника). Правда к методике расчета уровня раствора у меня все еще есть претензии и основная заключается в том, что чем более значительная разница в площадях контактов ЕС измерителя и контакта измерителя уровня тем меньшее влияние дает дальнейшее увеличение этой разницы. Таким образом, пока уровень затопления электрода уровня максимальный, то точность измерения низкая. Чем меньше остается раствора, тем более значительно возрастает точность.

Как раз не вижу в этом проблемы. Когда объем большой, то в принципе и не важно сколько там точно. Обычно задача датчика определить, что раствор кончается...

Может выложите нынешнюю схему?


**allex_step** 15-10-2017

> Обычно задача датчика определить, что раствор кончается...

Для такого случая используют поплавковые датчики

![](http://www.roskip.ru/_data/objects/0001/0102/img.10102.PDU-T502-m.jpg)


**siv237** 15-10-2017

> Хорошо, точность измерений есть. А что с составом раствора? Можно ли утверждать, что все микроэлементы остались на месте?

Да ктож его знает.

> Это можно отдельно обсудить. Как должен располагаться температурный датчик?

Для измерения ЕС это не сильно влияет, но чем ближе к электродам тем лучше, а вот при измерении уровня погрешности неравномерного нагрева сильно зависят (появляется явная корреляция с интенсивностью солнечных лучей в ясные дни). 

> Но если мне нужно не 8 независисмых ЕС, а управлять насосами и освещением, следить за влажностью воздуха... Вы предлагаете для этого другую ардуину использовать, или же эта сможет?

Кто мешает разделять на такты, хотя я для себя сразу разделил задачи управления и измерения на разные устройства, так как первое должно быть значительно надежнее, а второе часто менял в процессе экспериментов в том числе удаленно, не находясь дома. Таким образом нет опасности поймать нарушение полива в жаркие дни по вине кривой ПО-шки. 

> Как раз не вижу в этом проблемы. Когда объем большой, то в принципе и не важно сколько там точно. Обычно задача датчика определить, что раствор кончается...

Ну я хотел выйти на объемные значения расхода с высокой точностью, но получилось пока не очень и в литры перевести расход не получилось, особенно при большом наполнении. Но видеть, что раствор заканчивается и динамику потребления вполне можно.

> Может выложите нынешнюю схему?

Ссылка из первого сообщения актуальна, во всяком случае ПО не изменилось. Расчет ЕС на стороне ардуины с калибровкой по двум точкам работает отлично. По уровню в ПО пока только зачатки и наверно идею с точным уровнем можно забить, но плюс минус 10% раствора он точно покажет.

Единственно по схеме актуальной я использую только 1 аналоговый порт на измеритель, соответсвенно с рисунка нужно убрать связь А1---D10

Схема такая:

[tt]

A0----D11---ec-&gt;

D10---ec-&gt;

D9----------level------&gt;

[/tt]

Но ПО учитывает возможность измерения как ЕС так и уровня разными аналоговыми портами, но заметного прироста точности это не дает, так-как по сути АЦП у ардуины 1, а остальные просто перебираются по очереди.


**Vad** 15-10-2017

>  верх с отводами залить эпоксидом для исключения контакта с раствором 

Эпоксидка разрушается в воде, в процессе разрушения, будет выделять в раствор все, из чего состоит отвердитель.

что-то типа "Не использовать для склеивания пищевой посуды" на ней пишут именно по причине крайней токсичности отвердителя.

Термоклей тоже не применим, он гигроскопичен.

не ядовит, но под воздействием воды мутнеет, набухает и отваливается.. 


**PAA** 15-10-2017

> грифель пропитан парафином(как связующим

Обычно в качестве связующего выступает глина - чем тверже карандаш - тем больше в стержне глины. 

Идея со стержнями возникла не у меня. Один из уважаемых участников форума давно и успешно использует такой солемер.


**PAA** 15-10-2017

> > 
> 
> 
> 
> Тут единственное что вызывает сомнения, это сопротивление графита. Все таки графит не металл, его сопротивлением пренебречь не получится. Если окажется, что его сопротивление сильно больше сопротивления раствора, то мы потеряем в точности.

Ничего абсолютно не потеряете по двум причинам:

1. Сопротивление графитового электрода на много порядков меньше сопротивления раствора.

2.Сопротивление графитового электрода всегда постоянно, а значит его можно легко скомпенсировать. Для интереса замерил - огрызок карандаша из ИКЕА, длина 82 мм, сопротивление 7.8 Ом. Т.е. 1 см стержня имеет проводимость около 1 Сименс и это на три порядка больше чем проводимость раствора, учитывая что АЦП ардуины имеет разрядность 1024, то погрешность от сопротивления стержня будет где то на уровне младшего незначащего разряда (вот так то).


**vladindre** 15-10-2017

> Эпоксидка разрушается в воде, в процессе разрушения, будет выделять в раствор все, из чего состоит отвердитель.

Это может быть ширпотребный типа ЭД. У нас на работе делают композиты и клеи очень серьезные. По совету наших профи буду использовать ВК-27. Этим клеем собирают лопасти длиной 26м. В авиации что попало применять не будут поскольку чревато последствиями.

А отвердитель , да , вредный , но на время полимеризации смолы. После отверждения застывшая масса становится очень нейтральной средой. Вредность отвердителя вызвана наличием его радикалов во время реакции , а после окончания процесса нейтралитет.


**serge mat** 16-10-2017

> А отвердитель , да , вредный , но на время полимеризации смолы. После отверждения застывшая масса становится очень нейтральной средой. Вредность отвердителя вызвана наличием его радикалов во время реакции , а после окончания процесса нейтралитет.

Отвердитель вреден и до полимеризации и после. Он образует радикалы всегда, не только когда это нужно для отверждения эпоксидной смолы.

Здесь не так надо говорить. Отвердитель расходуется на полимеризацию, по окончании процесса его не остается.

Но мы понимаем, что это не так. Какая-то часть отвердителя останется. Что особенно печально, какая-то часть останется в массе, внутри. Она будет вымываться медленно.

Но вот вред его для растений я бы не преувеличивал, а просто проверил. Растения за годы биологической эволюции научились справляться с самыми разными проблемами. Главное, чтобы не много сразу. А так, по капельке - часто они справляются. 


**siv237** 16-10-2017

> Растения за годы биологической эволюции научились справляться с самыми разными проблемами. Главное, чтобы не много сразу. А так, по капельке - часто они справляются.

Слышал такое мнение и не раз, что разного рода вредные вещества растения впитывая корнями не пускают в плоды. Все остается в стеблях, листьях. Плоды при этом жестко ограничены от попадания в них лишнего.

Ходит даже байка, что чернобыльские яблочки радиоактивны только на шкурке, а внутри нормальны.


**serge mat** 16-10-2017

Давайте различать вещества и элементы.

Элементы не могут изменяться. Сколько элемента попало в растение, столько в нем и останется. Вопрос только в каком месте: в листьях, плодах, корнях...

Если попал радиоактивный изотоп элемента, то всё растение становится радиоактивным.

Если в растение попадет, к примеру, мышьяк, то растение станет ядовитым, потому что все соединения мышьяка ядовиты. В какое соединение мышьяк ни войдет, всё одно,будет ядом.

В случае с эпоксидкой мы имеем дело с органическими веществами, т.е. состоящими из элементов С, N, O, H. Что может быть опасно в этом случае, например производные гидразина, т.е. содержащие цепочки -N-N-. Такие цепочки могут сохраняться в растениях передавая ему ядовитые свойства. Эпоксид - это, напротив, цепочки -О-О- (перекисные). Они вполне успешно разлагаются в растениях. Они скорее опасны для растений, но точно не переходят состав веществ растения. Иными словами, если растение не загнется само, то ядовитым точно не станет.


**Borodach1** 16-10-2017

А почему не думаем про силикон? 

Бывает сантехнический, а бывает двухкомпонентный. Из двухкомпонентного делают даже формы для выпечки всяких кексов и т.п. Если его разрешили для контакта с пищей, да ещё и в тяжелых термических условиях, то для наших задач он должен быть вполне безвреден. 


**siv237** 16-10-2017

> А почему не думаем про силикон? 
> 
> Бывает сантехнический, а бывает двухкомпонентный. Из двухкомпонентного делают даже формы для выпечки всяких кексов и т.п. Если его разрешили для контакта с пищей, да ещё и в тяжелых термических условиях, то для наших задач он должен быть вполне безвреден.

Вот кстати да, я использую силиконовый герметик (для аквариумов) для герметизации стыков в воздушных коробах. Думаю если прям заявлено, что безопасен для рыб и водных растений, то проблем быть не должно.


**Vad** 16-10-2017

> > Тут единственное что вызывает сомнения, это сопротивление графита. Все таки графит не металл, его сопротивлением пренебречь не получится. Если окажется, что его сопротивление сильно больше сопротивления раствора, то мы потеряем в точности.
> 
> 
> 
> Ничего абсолютно не потеряете по двум причинам:
> 
> 1. Сопротивление графитового электрода на много порядков меньше сопротивления раствора.
> 
> 2.Сопротивление графитового электрода всегда постоянно, а значит его можно легко скомпенсировать. Для интереса замерил - огрызок карандаша из ИКЕА, длина 82 мм, сопротивление 7.8 Ом. Т.е. 1 см стержня имеет проводимость около 1 Сименс и это на три порядка больше чем проводимость раствора, учитывая что АЦП ардуины имеет разрядность 1024, то погрешность от сопротивления стержня будет где то на уровне младшего незначащего разряда (вот так то).

с какого перепугу у нас на погрешность стало влиять сопротивление электрода?

если оно не меняется.. и при калибровке (а без этого никак) будет просто вычтено из показаний.

да и сам принцип измерения позволяет сделать рабочее сопротивление раствора - любым!

меняем площадь электрода и расстояние между ними.. и уже ХОП... сопротивление раствора 10 ком..

ах, да.. на ардуине так не выйдет :D

при таком раскладе, там от 1024 значений... останется 10 :D 


**Vad** 16-10-2017

> У нас на работе делают композиты и клеи очень серьезные.

а у нас в квартире ГАС :D

Рекомендую ширпотребную полиэфирную смолу.

после отверждения полностью инертна, водо-кислото-щелоче устойчива, на поверхности образуется восковая пленка..


**siv237** 26-10-2017

Вот специально сгенерил график раствора на клубничном дереве (пролив "ствола" раз в час) за месяц в высоком разрешении:

Могу дать сорсы данных хоть за весь период, для неверующих...

Верхний график температура воздуха (фиолетовым) и раствора в баке (зеленым)

Средний - усредненные сырые значения АЦП за секунду по электроду ЕС (фиолетовый), уровня (зеленый)

Никаких методов сглаживания графиков не применяется, измерения не откидываются и все включены в усреднение за 1 секунду.

Нижний - значение ЕС калиброванное по двум точкам с параметрами калибровки:

ec2=2.826

x2=145

ec1=1.232

x1=63

[![](/imagehost2/thumbs/ecn1n.png)](https://t.me/ponics_ru_files/18547){:target="_blank"}

Отлично видно, что точности измерений, двумя проводками, более чем достаточно для бытовых задач.

Основные отклонения ЕС от ожидания вносит теплый или холодный раствор при при проливе его через трубу, так как температурный датчик и электроды несколько в разных местах раствора.

Разница в показаниях между электродом уровня и электродом ЕС указывает на уровень раствора, а точнее глубину погружения в раствор электрода. К сожалению градиент температуры в растворе и его динамическое не равномерное перемешивание насосом тут действует еще более сильно. 

Моя схема три алюминиевых проводка без обвязок прямо в ардуину, 2 одновременных раствора с опросом по очереди, проверял 4 одновременно, в том числе в одной емкости (взаимное воздействие не оказывается).


**siv237** 13-12-2018

[email][/email]На работе растет уже 3й год томат чери в подпоре. Окна северные, солнца прямого нет. Но тем не менее понемногу плодоносил.

К осени решили с коллегами автоматизировать немного процесс и переделать пассивный подпор в активный с контролем ЕС и расхода соли.

Автоматика такая: горшок с керамзитом стоит в поддоне с раствором, насосом раз в 5 минут идет полив сверху до переполнения горшка и отключается. 

Есть небольшой подогрев куском карбонового шнура на 12 вольтах. 

Есть датчики температуры воздуха, температуры раствора, влажности воздуха. 

Датчик ЕС из куска проволоки АВВГ, датчик уровня из двух вязальных спиц и датчик уровня ультразвуковой.

![](https://i.postimg.cc/rdp5mgs5/arduino-wega.jpg)

Скетч для arduino: https://paste.ubuntu.com/p/btwzCBJnSQ

Принцип описан тут: [http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino](http://ru.gidroponika.wikia.com/wiki/Измеритель_EC_на_основе_Arduino){:target="_blank"}

Цель, увидеть влияние негативных факторов - скачки влажности температуры и ЕС на развитие томата. Перед началом эксперимента 80% листьев и побегов было обрезано.

Оценить эффективность развития планировалось по динамике расхода соли из раствора.

Вот данные измерений за месяц

![](https://i.postimg.cc/K4cRBQyW/sens.png)

Сам стенд выглядит так:

![](https://i.postimg.cc/5Qpx656F/IMG-20181213-111329168.jpg)

![](https://i.postimg.cc/c6GcSpwn/IMG-20181213-111337903.jpg)

Растение страдает от того, что периодически проветривают кабинет, листья попадающие под холодный -20 воздух погибают, кроме того очень резко падает температура раствора и несмотря на то, что температура поддержания стоит на 20, такую достичь не получается. Нагрев добавляет около 4-5 градусов, т.е. без нагрева раствор холоднее 15.

Измерение уровня по электродам из спиц дало неожиданно высокую точность. А вот датчик ультразвука сильно подвержен изменениям показаний возможно связанных с изменением влажности. 


**VVS_** 13-12-2018

Информативно и красиво! В такие условия лучше клубнику разместить, ей почти пофиг на мороз из окна.

Вопрос по ЕС-метру.Измерение происходит на переменном токе? На ардуино это реализовать легко.


**allex_step** 13-12-2018

[size=2]каким макаром спицами уровень определяется?[/size]

[size=2]каким образом "[font=Verdana]полив сверху до переполнения горшка[/font][font=Verdana]" при керамзите?[/font][/size]


**VVS_** 13-12-2018

по сопротивлению же... если на переменном токе - метод весьма точный.


**siv237** 13-12-2018

И уровень и ЕС измеряются по переменному току высокой частоты.

Измерение уровня вынесено на отдельные электроды - являющиеся алюминиевыми спицами постоянного диаметра выставленными параллельно. 

Никаких нанотехнологий :)

![](https://i.postimg.cc/nMHKwvv8/photo-2018-09-27-15-48-46.jpg)

просто контакты припаяны флюсом по алюминию к вязальным спицам опущенным в раствор.

![](https://i.postimg.cc/Mvd2Cbch/photo-2018-09-27-14-10-09.jpg)

Все результаты измерений связаны в единой формуле выраженной через геометрические размеры. Меняем 1 параметр, меняется все.

Таким образом ЕС калибруется по линейке, как бы странно это не звучало.

![](https://i.postimg.cc/75YYFZKZ/photo-2018-11-02-17-06-00.jpg)

> каким образом "полив сверху до переполнения горшка" при керамзите?

Ну в горшке очень мелкие дырочки, и насос имеет значительно более высокую производительность. При этом горшок сам наполовину утоплен, вода уходит медленнее.

Схема позволяет регулировать мощность насоса, за счет того, что вместо механического - твердотельное реле на основе сборки дарлингтона, но устроил и вариант быстрой наливки с осечкой по касанию, чем подбирать мощность, которая к тому же еще и меняется.

Полив прикручен больше для того, чтобы быстрее перемешать раствор, так как измерения после внесения воды или соли некоторое время врут из-за неравномерности.

Резкие провалы уровня соли на графике связанны с тем, что из этой же емкости зачерпывается раствор для полива других растений.


**Chatl** 18-12-2018

Не совсем понятно, как измеряется уровень по ЕС. Ведь проводимость сильно зависит от температуры и концентрации раствора.


**siv237** 18-12-2018

> Не совсем понятно, как измеряется уровень по ЕС. Ведь проводимость сильно зависит от температуры и концентрации раствора.

Всё верно, это учтено в уравнении. Если интересно, могу всю математику выложить для понимания.


**siv237** 19-12-2018

Накидал в математическом виде решение задачи измерения уровня в баке кондуктометрическим методом.

Общие формулы

![](https://i.postimg.cc/47fhz6Hh/p1.png)

Совместное решение для ЕС и уровня

![](https://i.postimg.cc/FkZf17HV/ec-lev.png)

![](https://i.postimg.cc/7GKJX5St/p2.png)

Пример расчета

![](https://i.postimg.cc/QKV9zjb8/p3.png)


**Medded** 19-12-2018

Здорово! Оригинально и технически легко повторимо.


