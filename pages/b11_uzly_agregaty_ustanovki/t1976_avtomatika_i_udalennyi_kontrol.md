---
title: "Автоматика и удалённый контроль"
sidebar: ponics_sidebar
---

**cadiz** 26-02-2014

Хочется иногда порулить насосами и клапанами удалённо. Посмотреть как со влажностью в тепличке дела обстоят... Решений полно, особенно в промышленном секторе - выбирай чего хочешь. Но цены там... и размеры, масштабы... а устройства часто законченые и между собой связаны слабо или как-то сложно. Короче, захотелось чего-то простого, для маленьких тепличек или её частей и чтобы всё это работало как в жизни. Обычная веб-камера для визуального осмотра, обычные насосы для полива, обычные клапана, соленоидные или сферические из простого садового магазина, обычные дешёвые электроды pH и EC. Обычный Bluetooth, где контроллеров более одного, обычный интернет с обычным 3г и/или Ethernet, обычная страничка (типа как для настройки любого роутера) в обычном Firefox-Chrome-Opera для настройки всего этого дела на автоматический лад или управления в прямом эфире.

И, желательно, все используемые технологии должны быть открытыми и документироваными на просторах интернета, чтобы обычные программисты (и не только) могли способствовать развитию проекта. Разумеется. проект тоже делается открытым

![](http://storage7.static.itmages.ru/i/14/0129/h_1390964861_9763623_958e9751f2.jpg)

Итак, появилась платформа на базе контроллера STM32, которая постепенно обрастает функционалом и документацией. Благодаря уже написаной [базе функций](http://wiki.depo.ee/index.php?title=Cadi_functions){:target="_blank"}, создание своей программы значительно упрощается - да, можешь сам взять и написать свою функцию полива помидорок, какую захочется, мы ещё затронем эту тему подробнее

Что у нас есть? Есть [руководство пользователя](https://github.com/plantalog/cadi-gcl/blob/master/manuals/cadi_user_manual_rus_eng_v7.pdf){:target="_blank"}, которое даёт общее представление что можно сделать уже сейчас "из коробки".

Есть [схемы и дизайны плат](https://github.com/plantalog/cadi-gcl/tree/master/hardware){:target="_blank"}, которые используются в проекте.

Есть [исходный код](https://github.com/plantalog/cadi-gcl/tree/master/stm32f100){:target="_blank"} прошивки

И многое другое, что [процессе](http://wiki.depo.ee/index.php?title=Main_Page]уже документировано[/url] или в [url=http://plantalog.livejournal.com/){:target="_blank"}

Для чего всё это?

Представим на мгновение, что мы знаем как выращивать данную культуру (а это не редкость). Это знание подразумевает некий план для разных показателей среды - кислотность, наличие удобрений, влажность, температура, регулярность полива, содержание CO2... для всех этих величин можно нарисовать графики оптимальных значений.

И такие графики, действительно, существуют, в различных умных книжках и журналах.

Имея эти данные, можно точно или приблизительно повторить эти графики в реальной обстановке, запрограммировав контроллер должным образом. Когда мы это сделаем, у нас получится "тот самый" урожай.

Именно для этого мы и делаем эту штуку. Чтобы вырастить самый мощный урожай!

Порог вхождения

Я тут часто использую "просто" в предложениях. Признаться честно - для меня многие вещи неочевидны и неясны. Однако со временем и гуглом многое становится понятней. По мере продвижкния, я стараюсь описывать свой опыт максимально подробно (уровень подробности, штука, тоже объективная, конечно) в статьях в [блоге](http://plantalog.livejournal.com){:target="_blank"}. Мне кажетсяя, когда мы делимся опытом таким образом, мы делаем нашу работу полезней для общества (предмного благодарен многим участникам этого форума за репорты, с подробными рассказами что и как и с фотками. Всё это вдохновляет и помогает найти ответы на многие вопросы. Спасибо!)

Кроме того, появляются такие файлы как ["список функций Cadi"](http://wiki.depo.ee/index.php?title=Cadi_functions){:target="_blank"}, что должно упростить программирование до уровня изменения уже готовых рабочих решений во что-то своё, с минимальным риском привнести ошибку по незнанию.

Что было бы хорошо получить от вас, дорогие заинтересованые.

Это, прежде всего, незамыленый взгляд.

Новый человек, вникая в новую тему, сталкивается с рядом вопросов. Ответы, очевидные для разработчика этой темы, могут оставаться скрыты от новичков. Поэтому, вопросы - это хорошо. Задавайте их, пожалуйста! :)

НО! На любом форуме нынче правило - сначала воспользуйся поиском. Так и тут.

Однако, нам - заинтересованым в проекте, важно знать опыт других. Поэтому делитесь им, пожалуйста :)

Сим постом я приглашаю всех кто имеет интерес ко всяческой такой технике и растениям - подключайтесь!

Пользуйтесь, добавляйте свой опыт и наработки, задавайте вопросы. Буду рад ответить и помочь чем смогу :)


**cpf** 27-02-2014

Кмк,проект в любом случае -полезен.

Однако, пока сложно свести процесс получения урожая к простым алгоритмам, поддающимся полной автоматизации.

Много факторов остаются трудно формализуемыми, например: "подходящий сорт", "признаки недостатка или избытка элементов", "болезни", и еще сложнее описать зависимость их друг от друга.

В любом случае, проект надо развивать,- наверняка он поможет многим приобщиться к "агрофилам" :D.


**Coccinella** 28-02-2014

Только желательно излагать материал таким языком, чтобы и не техническая часть публики что-то понимала :-[


**cadiz** 03-03-2014

> Кмк,проект в любом случае -полезен.

Спасибо за позитивный отклик :)

> Однако, пока сложно свести процесс получения урожая к простым алгоритмам, поддающимся полной автоматизации.
> 
> Много факторов остаются трудно формализуемыми, например: "подходящий сорт", "признаки недостатка или избытка элементов", "болезни", и еще сложнее описать зависимость их друг от друга.
> 
> В любом случае, проект надо развивать,- наверняка он поможет многим приобщиться к "агрофилам" :D.

Простой алгоритм - понятие растяжимое. [машинное обучение](http://habrahabr.ru/post/187278/#comment_6527088]Вот[/url], к примеру, случай где компьютер сгенерировал сам эффективный алгоритм, который оказался эффективней более громоздких, придуманных человеком. Он меньше и эффективней работает (на практике это означает более качественное (скорость, задержки, бесперебойность) соединение с интернетом). Но делает ли это его простым? Отнюдь. Человек не в состоянии его понять (по крайней мере сейчас). Нам незачем думать о том, каков будет этот алгоритм, если мы применяем [url=http://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%88%D0%B8%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BE%D0%B1%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5){:target="_blank"}. Иными словами - компьютер сам подбирает нужный алгоритм достижения верного результата. Возникает вопрос "а из чего он выбирает нужный алгоритм?" Попробую рассказать как я это понимаю.

Тут есть два пути, как у любого из нас:

1. Мы используем базу накопленных знаний (книги, теоретические лекции)

2. Реализуем идею на практике (перебор возможных вариантов)

В первом случае мы "рассказываем" компьютеру о том, что из методов мы пробовали на практике (поливать чаще, реже, медленней, быстрей, с азтом, без, разные кислотности, ppm и так далее) и расставляем для каждого метода свои оценки (например, по пятибальной шкале, где 0 - наихудший резльтат, а 5 - то что надо). Так мы даём понять машине в теории "что такое хорошо, а что такое плохо" и как мы к этому пришли. Теперь машина может комбинировать эти методы для достижения ещё более хороших результатов (например, мы пробовали кислотность 5.8 и знаем, что она хороша, но также мы знаем что хорош ppm 1.5, но это знание мы получили при pH 6.1, логично попробовать сделать ppm1.5 при pH 6.1, правда? Так же и машина приходит к такому выводу и пробует данный вариант).

Вариант с практикой красочно описан в [другой интересной статье](http://gest.livejournal.com/1031836.html){:target="_blank"}. Компьютер просто перебирает все возможные комбинации и просит дать каждой из них оценку (оценку может давать человек или сенсор). По оценкам он принимает решение какой из вариантов оказался ближе.

Насколько я понимаю, даже человек не способен точно сказать в чём проблемы у растения (допустим фосфор и что? Передоз? Недодоз? Недодоз потому что мало кладём или потому что заблокировался и выпал в осадок?)

Но как-то выращивает. Я могу предположить, что нам везёт постоянно или того набора факторов, который мы учитываем - достаточно чтобы снять урожай. А это уже неплохая точка для старта машинной культивации растений. Немного обидно, конечно, что машины нас превосходят в чём-то... что же мы, дураки какие-то? Вовсе нет. Просто нашего внимания часто не хватает чтобы удержать в голове все детали происходящие в теплице.

[По теме машинного обучения есть курс от стэнфордского препода](https://www.coursera.org/course/ml){:target="_blank"}.

Таким образом, обычный термометр, который записывает температуру, например, раз в минуту - это уже что-то, что даст базу знаний нашей машине культивации.

Метеорология тоже когда-то начиналась с крайне малыми вероятностями совпадения предсказаний с реальностью, но постепенно прогнозы становятся всё точней и точней. И она тоже никогда не станет абсолютно точной, ведь, например, падение астероида случается не так часто, чтоб можно было учесть все его последствия в плане климата. И прогноз погоды "на завтра" может не сработать. Прмер, конечно преувеличенный, чтобы выразить контраст, но влияние неучтённых факторов исключить невозможно, ведь мы о них не знаем. Ни машина, ни человек.

Поэтому всё что нам сейчас остаётся - это растить и ещё раз растить, позволяя девайсу записывать отчёты о всех наших действиях (полил тогда-то, столько-то, с такими-то добавками) и все данные, которые можем собрать (температура, влажность, освещённость, содержание углекислоты в воздухе, кислотность раствора и насыщенность солями...), на SD карту (а это му можем в текущей версии Cadi). А потом пускай анализирует.

Алгоритмы? Я с вами солидарен - для человека это сложно. Пускай компьютер сам подбирает их. И это возможно.

Не сегодня - завтра, машины-роботы будут ездить по дорогам и мы работаем в этом направлении очень интенсивно. А на дороге ошибки куда фатальней чем в теплице. И ничего, продолжаем развивать это направление. Сегодня самолёты взлетают и садятся сами. Да, пассажирские с обычными людьми на борту, которые после посадки хлопают в ладоши. Автопилоту.

> Только желательно излагать материал таким языком, чтобы и не техническая часть публики что-то понимала :-[

Рад ответить на любые вопросы. Что именно непонятно?

Мне кажется, так или иначе, чтобы понять всё до конца, необходимо стать этой "технической частью публики". А если просто какой-то момент прояснить... Например, чтобы мне понять смысл сообщения:

"А для помещений полудеты лучше, они ниже и более ранние. А при желании им можно отпускать пасынки из любого узла и формировать хоть веером :) Это в производстве удобнее с индетами работать и урожай у них выше, а Вам же не на рынок"

мне нужно разобраться что такое "полудеты" и "индеты". Для этого я иду в поиск и ищу там этот термин. Если не нахожу в поиске, то гугл (яндекс, яху, нужное подчеркнуть) помогает отыскать ответ. А если я общительный, то задам вопрос прямо тут же - "что такое полудет, расскажите пожалуйста. чем отличется от индета?"

И вполне нормально, что вы, каждый раз упоминая это слово, не объясняете его смысл. Для вас смысл этого слова очевиден так же, как для кого-то "сторожевой таймер". Поэтому, давайте начнём задавать вопросы :)

Что такое полудет?

Что я делаю не так?


**Vad** 03-03-2014

полудет это полудет :D

полусамозавершковывающийся.. :D не карлик и не бесконечный шланг :-\ средного роста короче :D 

по второму вопросу.. надо вырастить 1 растение.. всего одно.. вручную.. и сразу станет ясно, что автоматизировать, за какими параметрами наблюдать, и главное.. нужно ли за ними наблюдать в принципе ;)

*8)*


**cadiz** 03-03-2014

> полудет это полудет :D
> 
> полусамозавершковывающийся.. :D не карлик и не бесконечный шланг :-\ средного роста короче :D 
> 
> *8)*

А индет что такое?

> по второму вопросу.. надо вырастить 1 растение.. всего одно.. вручную.. и сразу станет ясно, что автоматизировать, за какими параметрами наблюдать, и главное.. нужно ли за ними наблюдать в принципе ;)

![](http://storage8.static.itmages.ru/i/14/0303/h_1393879865_7149707_8637982997.jpg)

![](http://storage9.static.itmages.ru/i/14/0303/h_1393879866_4344795_5a0a18351b.jpg)

![](http://storage6.static.itmages.ru/i/14/0303/h_1393879751_4474786_e81680a233.jpg)

![](http://storage7.static.itmages.ru/i/14/0303/h_1393879751_6655421_86ef5d9e79.jpg)

![](http://storage5.static.itmages.ru/i/14/0303/h_1393879957_9323750_31c53cd6b2.jpg)

![](http://storage7.static.itmages.ru/i/14/0303/h_1393879982_2026563_8666134b99.jpg)

:)

ещё?


**Vad** 03-03-2014

конечно еще!

если этого мало, чтоб понять :D

дет=!индет

так понятно? :D


**cadiz** 03-03-2014

По-теме топика:

вот так начинается дизайн и вёрстка панели управления для устройства

![](http://storage6.static.itmages.ru/i/14/0303/h_1393805644_9078014_8c76c4a0cf.png)

Это вкладка Direct Drive

Подразумевается два режима работы контроллера - автономный и прямое управление (Direct Drive он же DD).

Автономный режим характерен тем, что контроллер сам управляет исполнительными устройствами (клапана, насосы, свет, вентиляция, увлажнители)

Direct Drive режим отключает управление исполнительными устройствами (и только. сенсоры вроде температуры, pH и прочих продолжают работать как обычно). Флаги таймеров и стабилизационные флаги продолжают выставлятся как запрограммировал пользователь, однако более не влияют на поведение исполнительных устройств. В режиме Direct Drive управление полностью передано внешнему устройству (например, компьютеру, вроде [Raspberry Pi](http://www.raspberrypi.org/){:target="_blank"} на котором запущен веб-сервер apache и работает панель управления CadiWeb)

CadiWeb - это, грубо говоря, веб-сайт, который позволяет управлять контроллером Cadi с любого устройства на котором есть браузер интернет-страниц, типа, Mozilla Firefox. Такими устройствами являются все компьютеры, планшеты (таблетки?), смартфоны с андроидом, блэкберри, айфоны, макбуки и всё такое.

Как приводилось в пример выше, можно запустить такой сервер на коробочке вроде Raspberry. Вот она

![](http://storage7.static.itmages.ru/i/14/0303/h_1393885819_9131205_55e667f021.jpg)

То есть запуском apache мы [Raspberry](http://plantalog.livejournal.com/11133.html]превращаем эту коробочку в сервер[/url] управления автоматикой для растений. Остаётся только воткнуть в [url=http://ru.wikipedia.org/wiki/Raspberry_Pi){:target="_blank"} сетевой провод из роутера с интернетом и полив любимых черри томатов становится на расстоянии доступного интернета.

Можно запустить веб-сервер и на любом другом компьютере, особенно легко с [линуксом](http://ru.wikipedia.org/wiki/Linux){:target="_blank"}

Можно исключить коробочку Raspberry и вообще внешнее управление и мониторинг. Основные функции доступны для настройки 4 кнопками и дисплеем, которые видны на первой фотографии поста.

> дет=!индет
> 
> так понятно? :D

Лучше покажи что там у тебя задефайнено на эти имена :)

В [моей последней версии библитеки русского языка](http://gramota.ru/){:target="_blank"} таких определений не найдено :)

А если серьёзно, кто из них выше-то?


**Vad** 03-03-2014

> Лучше покажи что там у тебя задефайнено на эти имена :)
> 
> В [моей последней версии библитеки русского языка](http://gramota.ru/){:target="_blank"} таких определений не найдено :) 

выполните обновление либов.. и лэнгвичпаков, подключите новые (тематические) репозитории :D

[отсюда](http://ru.wiktionary.org/wiki/%D0%B4%D0%B5%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BD%D1%82%D0%BD%D1%8B%D0%B9){:target="_blank"} например ;)


**cadiz** 03-03-2014

Теперь понятно :)

Спасибо!


**Coccinella** 04-03-2014

> Лучше покажи что там у тебя задефайнено на эти имена :)
> 
> В [моей последней версии библитеки русского языка](http://gramota.ru/){:target="_blank"} таких определений не найдено :)

:) Вы уверяете, что "задефайнено на эти имена" содержится в "последней версии библитеки русского языка"? Я не проверяла, недосуг (а может, лень :-[)


**Gnevko** 06-03-2014

Тема немного сбилась с пути начального. Поэтому вопрос, дабы вернуть :) 

Обучение машин - это конечно хорошо, и для этого нужна обратная связь в виде датчиков. На сегодняшний день набор этих самых датчиков/сенсоров весьма стандартен в любительсткой среде: температура, влажность, ЕС, РН, более продвинутые вещи - освещенность, давление, СО2. Но, все это позволяет лишь весьма косвенно и весьма с большой задержкой пороанализировать, что же на самом деле может происходить с самим растением. А вот как измерить в реальном времени 1) поток внутри ствола 2)Раскрытие утьиц 3) налив плодов и т.д?


**Coccinella** 06-03-2014

Какими датчиками измеряют поток внутри ствола, я не знаю, а степень открытия устьиц и налив плода можно измерить оптическими сенсорами, только я не уверена, что это так уж необходимо. 

В Израиле есть системы фитмониторинга растений для управлекния поливом в открытом грунте, именно по сукорости налива плода и определяют, надо еще поливать, или уже хватит. Их и в Украине применяют (от коллег и слышала), но меня лично такой подход несколько смущает. У томатов зачастую первый плод наливается до невообразимой величины, а остальные при этом не растут, поэтому полив по приходу солнечной радиации и содержанию воды в субстрате надежнее.


**cadiz** 07-03-2014

Как верно подметила Coccinella, оптический анализ позволит получить эти данные.

То есть, обычная камера плюс программное обеспечение вроде [OpenCV](http://ru.wikipedia.org/wiki/OpenCV){:target="_blank"} (Open Computer Vision - открытое ПО компьютерного зрения)

[Тут](http://habrahabr.ru/post/208092/){:target="_blank"} рассказано как натренировать компьютер на распознавание плюшевой совы в видеопотоке. Заменяем сову на плод томата или устьице и тренируем машину распознавать эти образы.

Поток жидкости в стволе - есть [люминисцирующие](http://ru.wikipedia.org/wiki/%D0%A4%D0%BE%D1%82%D0%BE%D0%BB%D1%8E%D0%BC%D0%B8%D0%BD%D0%B5%D1%81%D1%86%D0%B5%D0%BD%D1%86%D0%B8%D1%8F){:target="_blank"} добавки, которые светятся если их облучать правильным светом. Если шибко хочется проследить за током жидкости в стволе, то это может решить задачу. Другой вопрос - зачем? По-моему, для начала надо хотя бы поставить библиотеку OpenCV и научить машину собирать созревшие помидоры. Думаю, это более актуальная задача в сегодняшних реалиях.

Задаваться вопросами о токе в стволе на данном этапе, когда электроника в выращивании растений ещё молода, равносильно вручению учебника по матану ребёнку лет шести или озадачиванию его вопросом о правильности доказательства Перельманом теоремы Пуанкаре. Потихоньку, помаленьку и будет всё это. Ребёнок подрастёт, изучит основы и придёт к этому вопросу сам.

А если не придёт - другая у него дорога, значит :)

Релевантно к теме - попробуйте собрать для начала каскад распознавания томата или огурца. Когда это получится, бОльшая часть вопросов отпадёт сама собой и многое станет очевидным.


**zorx** 11-03-2014

Сложновато для хобби, да и порог вхождения высокий.

Я на ардуине делаю - ph, свет, температура, программы полива. Мониторинг пока в plot.ly.


**cadiz** 10-04-2014

Камера поставлена, сервер настроен, пошла первая "телеметрия" :)

![](http://storage6.static.itmages.ru/i/14/0410/h_1397132143_1612801_f6b0cd6b65.jpg)

На самом деле первый успешный коннект состоялся уже пару месяцев назад. Но тогда команды управления были по одному байту и без контроля целостности.

А теперь у нас есть полноценный протокол обмена. Данные можно слать пакетами. Пакеты снабжаются контрольной суммой, чтобы избежать ложных срабатываний.

Из печальных новостей - малина не заводится больше, после экспериментов с 3G модемом.

Поэтому (для кого-то хорошая новость :)), малиновый [демон](http://ru.wikipedia.org/wiki/%D0%94%D0%B5%D0%BC%D0%BE%D0%BD_%28%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%29){:target="_blank"} bt_daemon.php был быстренько адаптирован под Ubuntu и теперь вместо малины у нас обычный лаптоп. А за подачу интернета отвечает роутер.

Более подробно по изменениям в прошивке можно почитать в файле [changes.txt](https://github.com/plantalog/cadi-gcl/blob/master/stm32f100/changes.txt){:target="_blank"} на Github

Новая прошивка Cadi v2 ориентирована на дизайн платы [Cadi mainboard 140206](https://github.com/plantalog/cadi-gcl/tree/master/hardware/cadi-mainboard){:target="_blank"}


**cadiz** 10-04-2014

а чуть позже вкладка Direct drive переехала вся на главную вкладку Status

![](http://storage5.static.itmages.ru/i/14/0410/h_1397165927_3942670_e552df7cb4.jpg)


**Strangeman** 11-04-2014

А камера тоже k STM-32 подключена?


**cadiz** 12-04-2014

Камера подключена к x86 компу под управлением Ubuntu. bt_daemon щёлкает камерой посредством fswebcam

sudo apt-get install fswebcam


**Strangeman** 12-04-2014

Как под Линуксом щелкать я в курсе. На самом деле motion вообще рулит.

Я уж было подумал, что этот СТМ видеопоток гонит и малость был озадачен.

Вот на малине, кстати, вполне можно сделать все то же, но в комплекте и HTTP server и камера.


**cadiz** 22-04-2014

Малина уже была и приказала долго жить. Поэтому принято решение в пользу более проверенного временем компа на x86

Малина была как вспомогательное устройство и, даже если бы была неубиваемой, никак не может заменить даже F100 за неимением такого обилия портов, как у STM32.


**Strangeman** 22-04-2014

Если не изменяет память - 22 GPIO. Неужели мало? ADC отсутствует - это явный минус.

Я правильно понимаю, что на STM реализовано только исполнительное устройство и без сервера оно не живет?


**cadiz** 28-04-2014

Cadi живёт без сервера. У него есть свой интерфейс управления и настройки в виде 4 кнопок и дисплея, есть свой набор программ, которые он отрабатывает без внешнего воздействия... Вы видели [мануал](https://github.com/plantalog/cadi-gcl/blob/master/manuals/cadi_user_manual_rus_eng_v7.pdf){:target="_blank"}? Или исходники? Что-то требует дополнительного объяснения?

У малины 8 GPIO из 26 пинов всего (из которых 6 - это DNC и 3 - питание). Вижу, вы поклонник малины? Мы можем сделать что-то вместе по проекту :)

Малина - штука интересная. Мне она кажется полезной в виде шлюза интернет для Cadi. Если вы подробно расскажете (коммитом стартап-скрипта в репозиторий) нам как сделать, чтобы на малине без монитора и мышки автоматом стартовал 3Г интернет с USB стика (желательно, любого), Cadi отвесит вам низкий поклон, чесслово :)

А пока дохлая малина не шевелится, у нас и на х86 неплохо получается

Собран тестовый конфиг по такой схеме

![](http://storage5.static.itmages.ru/i/14/0428/h_1398709508_6031563_aaf8cce16a.jpg)

В качестве насоса для полива (5) используется мембранный насос высокого давления.

3 и 4 это пластиковые вёдра на 100 и 20 литров соответственно

Клапаны 8 и 10 - шаровые.

6.1 и 6.2 - клапаны соленоидные

Клапан (8) на кране подаёт воду через фильтр (9) в бак (3). За уровнем воды в этом баке следит ультразвуковой сенсор. Если не хватает, клапан открывается и остаётся открытым, пока потеря не восполнится. В баке (3) чистая вода ждёт своего часа. Час наступает, когда открывается клапан (10) подачи воды в бак для смешивания растворов (4). Тут к воде, если требуется, примешиваются удобрения при помощи Fertilizer Mixer. Далее вода поступает на полив, нагнетаясь с магистраль насосом (5). Клапана 6.х выбирают куда дальше течь воде. Номером 7.2 обозначен сенсор давления, который позволяет устанавливать требуемое для полива давление воды на выходе. 7.1 - это манометр, который используется для калибровки сенсора давления. Давление необходимо поддерживать в заданных пределах для обеспечения равномерного полива через компенсированные дрипперы. Этим Cadi занимается после того как сделана настройка сенсора и насоса из меню "PSI sensor cal."


**cadiz** 02-05-2014

А теперь добавим эту схему в панель управления, сделаем переключалку между схематичным изображением и картинкой с камеры и на схематичное изображение добавим слой с информацией о статусе, изложенной более наглядно, чем сухие цифры.

Так, воды в баках должно быть на картинке столько же, как и в реальных баках. Над клапанами будут светофорчики, показывающие текущий статус... ну вы поняли.

![](http://storage6.static.itmages.ru/i/14/0502/h_1398999128_5443475_b26976b607.jpg)


**Mole_Garden** 20-09-2014

Как движется процесс и движется ли он вообще?


**cadiz** 06-10-2014

Mole_Garden, спасибо за проявленный интерес :)

Вкратце:

Разрозненные части упаковались в короб из пластика, насосы дозирования удобрений были взяты на сей раз посерьёзней (надёжней стартуют и работают в целом), соединения сделаны из ПВХ. Много работы сделано по софту для панели управления и по прошивке.

В работе: [Видео](https://www.youtube.com/watch?v=cg16DZYGGvo){:target="_blank"}


**Mole_Garden** 06-10-2014

> Mole_Garden, спасибо за проявленный интерес :)
> 
> Вкратце:
> 
> Разрозненные части упаковались в короб из пластика, насосы дозирования удобрений были взяты на сей раз посерьёзней (надёжней стартуют и работают в целом), соединения сделаны из ПВХ. Много работы сделано по софту для панели управления и по прошивке.
> 
> В работе: [Видео](http://www.youtube.com/watch?v=cg16DZYGGvo){:target="_blank"}

Т.е. на данный момент идет отладка конструкции перед тем как это будет уже поступать в массы? Какова конецчная цель проекта? Сделать девай как решение и поставлять с тем функционалом, который есть или делать девайся под заказчика? 


**cadiz** 06-10-2014

Цель этого проекта - разработать девайс, который сможет выручить гровера в его отсутствие. 

Да, по конкретно этому проекту сейчас остались нерешёнными некоторые вопросы, вроде крышки и более красивого и актуального интерфейса в панели управления.

И конкретно этот проект может быть растиражирован без проблем.

Стану ли я делать что-то новое? Конечно, если мне это будет интересно и возможно технически. А что? У вас есть идеи? :)


**KOHCEPBATOP** 20-02-2015

Всё это конечно интересно,- полив по таймеру и ультразвуковые датчики, но почему нет контроля за питательным раствором. Ведь можно же приспособить TDSметр и рНметр к девайсу и уже удалённо наблюдать за качеством раствора. Также на основании полученных данных, можно удалённо корректировать раствор. Например долить воды при повышении ppm ,или подкислить при повышении рН. Хотя более сложные манипуляции всё ещё требуют присутствия человека на месте.


**Strangeman** 25-02-2015

KOHCEPBATOP, насколько я понимаю, идет обсуждение ядра проекта. Датчики можно прикрутить любые. Тем более, что проект открытый и такого рода критика несколько удивляет. Нужны pH и электропроводность - подключайте датчики и исполнительные механизмы, дописывайте управление.


**Grolly** 07-04-2015

Всё верно.

Датчики прикручиваются любые.

Раз уж зашла о них речь, то расскажу немного про них.

Как мы помним (если читаем не только этот топик, а новости по проекту вообще), изначально сенсоры кислотности и солей были заведены на аналоговые входы. Но, слухами земля полнится, выяснилось, что лучше бы из делать изолированными гальванически. Разумеется, если развязывать сигнал, то надо и питание развязать. Так было откопано ценное знание о том как сделать эту двойную развязку. Вместе со знанием пришла ссылка на [готовую плату усилителя-оцифровщика для pH](https://www.tindie.com/products/rezahussain/dormant-labs-ph-module-v2/?pt=full_prod_search){:target="_blank"}. Тут уже сделана развязка по питанию и сигналу. Сигнал идёт по I2C.

Оцифровывает у него всё микроскопический MCP3221 о 5 пинах. Это 12-бит АЦП.

Для солей такого я не нашёл готового, поэтому сваял самопал из:

1. Две пластинки нержавейки

2. операционный усилок за бакс с ибэя для измерения влажности

3. ардуина мини (чтоб цифровать это всё и слать далее), 

4. развязка по питанию

5. развязка по цифре

Для пункта 4 было взято что-то вроде такого

![](http://storage2.static.itmages.ru/i/15/0407/h_1428418694_6375394_99a9f6f304.jpg)

А для развязки по цифре спецовая финтифлюшка Adum1250. У Резы, на модуле кислотности, для этих целей стоит SI8600.

Разумеется, все показания мониторятся и поправляются удалённо, если надо.

И да, спасибо за понимание Страннику, проект открыт - бери и пользуйся.


**Daenur** 24-08-2015

Подпишусь на тему для отслеживания.

А где-то ведется блог по проекту, исходники, схемы и прочее выкладывается? Сам думал на Raspberry что-то подобное сделать, но не хочется изобретать велосипед, если уже есть готовое открытое решение.


**amator** 31-08-2015

Автор тот же.

[http://blog.aquaplant.ee/](http://blog.aquaplant.ee/){:target="_blank"}


**alexxx** 10-09-2015

Для солей: 

![](https://storage4.static.itmages.ru/i/15/0907/h_1441666762_3411847_3b9597c3e0.png)

Это EVAL-0349. Референсная плата измерения импенданса.

Зачем это нам? Да это EC-метр, по-простому.

Построена на достаточно навороченом чипе AD5934, который снимает спектры импенданса с разными частотами измеряющих импульсов.

Как мы все помним, для измерения электропроводимости воды нужно использовать переменный ток, чтобы минимизировать загрязнение электрода. Здесь можно настроить чип так, чтобы он делал до 512 замеров, начиная с частоты F и наращивая её с каждым шагом на I и выгружая эти все измерения по шине I2C.

Кроме этого, на плате присутствует электронный свитч на 8 канало ADG715, который позволяет на лету переключать пределы измерений, делая возможными измерения в диапазоне от 25 микроСименс, до 200миллиСименс. ADG715 программируется тоже по I2C, отправкой всего одного байта. Есть вход под датчик температуры, для компенсации измерений. Переключая каналы ADG715 можно выбрать на вход не электрод, а один из трёх калибровочных резисторов. Это делает возможным автоматическую калибровку.

Всё это великолепие, разумеется, снабжено гальванической развязкой по питанию и цифре.


**gena1** 10-09-2015

Нашел её только за 50 долл. + доставка в РФ.

Не, на простом операционнике за 11 рублей дешевле + программный хардкор с термокомп-ей и калибровкой :)


**amator** 19-09-2015

> Нашел её только за 50 долл. + доставка в РФ.
> 
> Не, на простом операционнике за 11 рублей дешевле + программный хардкор с термокомп-ей и калибровкой :)

На Диджике 48,96 , на бакс дешевле.

Только кто этой девайсиной рулить будет?


**aspidus** 18-10-2015

Приветствую всех! Реально готовые работующие системы (аппараты, растворные узлы) есть? Если есть опубликуйте фото чтобы было ясно, а то только теория. Наверное эту тему начали не просто так лишь бы пообщаться. Есть товар есть заказ нет товара нет заказа, а остальное - толкание воздуха. Прошу прощения за резкость и прямолинейность, но нет времени сидеть и читать "воду". Те кто защищал дипломы понимают о чем идет речь!!! ;) 


**amator** 29-11-2015

> Приветствую всех! Реально готовые работующие системы (аппараты, растворные узлы) есть? 

Работующих нет. Работающие есть

> Прошу прощения за резкость и прямолинейность, но нет времени сидеть и читать "воду". Те кто защищал дипломы понимают о чем идет речь!!! ;) 

Видимо перед защитой его купить надо, а время поджимает?


**Vad** 29-11-2015

> нет времени сидеть и читать "воду". Те кто защищал дипломы понимают о чем идет речь!!! ;) 

Лето красное пропела, оглянуться не успела, как диплом катит в глаза. :D


**G2v2** 04-05-2016

Продолжаем топик, хоть и пришлось зарегаться заново (не работает восстановление пароля на этом форуме. Админ, в чём дело?).

aspidus, ты хочешь купить? Или собрать по чужим схемам рабочий девайс, чтоб работал и не надо было вникать в электронику, программирование и электрику с гидравликой? Если второе, пожалуйста, приезжай в гости и фоткай сам наши девайсы в деле. Тебе кажется, что много воды? Не те ракурсы? Приезжай и сделай как надо, поделись с народом так, как ты бы это хотел видеть от остальных :) Я только ЗА! :)

К чему подключать EVAL0349 - к любому контроллеру с I2C или без него, если сумеете сами дровину написать. Контроллеры такие нынче стоят в пределах бакса (более навороченные подороже, разумеется). Хочется чтоб работало из коробки? Добро пожаловать в личку, обсудим ценники.

Почему EVAL0349 лучше чем простой операционник?

Тем, что у EVAL0349 помимо упомянутого операционника есть ещё куча фич. Например, программное переключение диапазонов измерений, которое только на операционнике никак не осуществить впринципе. Есть изоляция по цифре и питанию. Изоляция на операционнике? Чего? Аналогового выхода? :))) Вот вам и АЦП уже надо ставить... 

Да, оно дешевле на операционнике, только ещё дешевле и надёжней делать (может, проще купить?) тогда на таймере. И развязка уже есть.

Пример схемы: 

![](http://gcl.engineering/kb/images/c/c2/SMX555sc.gif)

С такой схемой отлично работает простейший, самопальный сенсор проводимости такого типа

![](http://gcl.engineering/kb/images/7/7c/160211_ec_sensor_lm35.jpg)

В нём чернеется датчик температуры, для компенсации. Металл позолочен, ничего не окисляется.


**siv237** 15-11-2017

Есть ли у кого опыт использования такого датчика расстояния, для контроля уровня раствора:

[https://ru.aliexpress.com/item/K02-integrated-ultrasonic-ranging-module-parking-sensor-waterproof-ultrasonic-sensor-module/32751241148.html](https://ru.aliexpress.com/item/K02-integrated-ultrasonic-ranging-module-parking-sensor-waterproof-ultrasonic-sensor-module/32751241148.html){:target="_blank"}

Заявлена водонепроницаемость и как я понял принцип работы и сопряжения аналогичен обычному HC-SR04, который к сожалению во влажной среде показывает бред :(

[![](/imagehost2/thumbs/htb1p4vpabohl1jjszfwq6z6vpxaq.jpg)](https://t.me/ponics_ru_files/12438){:target="_blank"}


**vladindre** 15-11-2017

> который к сожалению во влажной среде показывает бред

Во-во. Чего я и опасался ранее. Моя мысля таки подтвердилась. Надежней и проще обычный контактный.


**siv237** 15-11-2017

> > который к сожалению во влажной среде показывает бред
> 
> 
> 
> Во-во. Чего я и опасался ранее. Моя мысля таки подтвердилась. Надежней и проще обычный контактный.

Контактные, через электропроводность - откалибровать крайне сложно. Поплавковые и вообще любая механика - низкая надежность, требуют обслуживания. Датчики давления жидкости как я понял (сам не пробовал) теряют точку привязки со временем как и тензометрические датчики для взвешивания. 

По сути самый точный остается ультразвук но образование капелек внутри датчика на мембране всё портит.

Вообще измерение уровня раствора дешево и с хорошей точностью так и остается для меня нерешенной задачей.


**orgail** 15-11-2017

изолированный магнит, изолированный геркон... не?


**Пресвятой_ДжимБим** 15-11-2017

> изолированный магнит, изолированный геркон... не?

Поплавковый геркон :D 


**orgail** 15-11-2017

ну дальше у кого как фантазия развита :D

главное, что магнитное поле - не "проржавеет" :D


**Пресвятой_ДжимБим** 15-11-2017

> ну дальше у кого как фантазия развита :D
> 
> главное, что магнитное поле - не "проржавеет" :D

Не, я серьезно))) использовал поплавковую систему. Там внутри поплавка магнитик, а внутри корпуса геркон. Очень четко свою функцию отрабатывало. Проще и надёжнее некуда)


**orgail** 15-11-2017

та я тоже серьезно, просто конструкции бывают разные.


**allex_step** 15-11-2017

разница в том что дуиной можно установить срабатывание при определенной величине расстояния

а поплавком как? сдвинуть ведь не получится...


**orgail** 15-11-2017

так нужен измеритель уровня или датчик уровня? хотя, зачем вам измерять больше 1-2 значений - непонятно... потребление растением? ну добавьте еще пару герконов по высоте - будете знать за какое время сколько ушло по уровням. А вообще это какое то конструирование коня в вакууме... 


**Borodach1** 15-11-2017

А нафига он нужен этот датчик уровня??? 

Делаете перелив, а дальше как фантазия позволит включать насос. Хочешь каждые 15 минут по минуте, а не хочешь часто включай каждые три часа по пять минут. 


**allex_step** 15-11-2017

как-то сильно ограничено... а если без перелива?

т.е. иная система

> [font=verdana]так нужен измеритель уровня или датчик уровня? хотя, зачем вам измерять больше 1-2 значений - непонятно... потребление растением? ну добавьте еще пару герконов по высоте - будете знать за какое время сколько ушло по уровням. А вообще это какое то конструирование коня в вакууме...[/font]

[font=verdana]ну держать уровень раствора в трубах по дно стаканов - снизился уровень -&gt; добавить раствора[/font]

[font=verdana]потому и регулирование уровня срабатывания необходимо т.к. по началу взлив чуть выше(слегка смачивает керамзит на дне стаканов), а как отрастут корни - уже ниже делать[/font]


**Пресвятой_ДжимБим** 15-11-2017

Дык это. Ставишь два уровня. Один нижний(критический) , второй верхний(чтоб перелива не было. И все. Дёшево и сердито.


**allex_step** 15-11-2017

это не о том...

вопрос не о критический/перелив, а о поддержании установленного пользователем уровня


**Пресвятой_ДжимБим** 15-11-2017

Ааа.. ну задача сильно усложняется Тада. Это того не стоит..


**allex_step** 15-11-2017

ожидаемая ~~эрекция~~ реакция :D 


**Пресвятой_ДжимБим** 15-11-2017

 :D


**Borodach1** 15-11-2017

Делаете перелив по требуемому уровню поддержания и хоть не выключайте насос совсем. Уровень будет всегда такой как нужно.))) 


**siv237** 15-11-2017

Задача измерить некий критический уровень решается примитивно без всяких герконов двумя проводками. Я говорю о измерении текущего количества раствора ну или хотя-бы точного уровня. Причем с точностью не хуже 1%. Уз дает такую точность и даже выше, особенно с использованием методов статистической фильтрации, но при условии того, что воздушная среда не меняет свои свойства между уз датчиком и зеркалом воды, а она меняет. Температура, влажность и давление влияют на скорость звука - а значит и на определение расстояния основанное на скорости звука. Кроме того конденсат и капли на поверхности вообще убивают не просто точность, а полностью всю логику измерения.

В общем простого метода измерения уровня (именно уровня, а не достижения неких пределов этого уровня) не просматривается :(


**siv237** 15-11-2017

> так нужен измеритель уровня или датчик уровня? хотя, зачем вам измерять больше 1-2 значений - непонятно... потребление растением? ну добавьте еще пару герконов по высоте - будете знать за какое время сколько ушло по уровням. А вообще это какое то конструирование коня в вакууме...

Потребление раствора по времени в привязке к температуре, влажности и освещенности - важный количественный показатель. Не менее важный чем ЕС. Например зная, как изменяется ЕС в зависимости от остатка раствора, можно судить об оптимальности питания.


**Vad** 15-11-2017

> Например зная, как изменяется ЕС в зависимости от остатка раствора, можно судить об оптимальности питания.

нифига подобного :D


**orgail** 15-11-2017

Я может чего не понимаю, но уровня где? В чем? В горшке, постоянно зарастающем корнями? Это не даст никакой точности. Да и не нужна тут никакая точность с 1%. 

На уровне более - менее взрослом эта задача решается легко. 

На подоконнике - это измерение непонятно-чего. И тем более - делать выводы на выборке трех растений и давать потом советы другим - большая ошибка.


**siv237** 15-11-2017

> Я может чего не понимаю, но уровня где? В чем? В горшке, постоянно зарастающем корнями? Это не даст никакой точности. Да и не нужна тут никакая точность с 1%. 
> 
> На уровне более - менее взрослом эта задача решается легко. 
> 
> На подоконнике - это измерение непонятно-чего. И тем более - делать выводы на выборке трех растений и давать потом советы другим - большая ошибка.

Верное замечание, я забываю, что помимо периодики протоки и подпора некоторые используют DWC.

Естественно, измерять смесь корней с водой и солями да еще и постоянно бурлящую смысла никакого нет, хотя в свое время делал выносной контроль уровня для DWC путем соединения емкости с корнями и отдельной емкости для измерения с помощью трубки. Растворы по правилам соединяющихся сосудов на одном уровне, но все-равно определить сколько там корней, а сколько раствора не выйдет.

Ну а ставить вопрос так, что мол раз нет возможности то и не надо, это уже перетягивание и подмена причины следствием.


**orgail** 15-11-2017

Подпор и периодика не исключение и сталкивается с теми же трудностями. Уровень раствора... это настоящий конь в вакууме.

Какие либо выводы обычно делают на достаточно больших выборках растений. Там, где для этого обычно используют технику сложнее EC-метра. И где общее количество раствора, потребленное растениями посчитать достаточно просто.


**siv237** 15-11-2017

Просто задача - полупрозрачная емкость с раствором. Тарированные метки на ней позволяют на глаз определить уровень с точностью до литра. Для 30 литровой емкости - это меньше 5% погрешности. Прям хоть камерой снимать и распознавать.

Неужели нет никаких доступных вариантов постоянных измерений для получения в виде графика?

Через замер давления водяного столба кто-то пробовал?


**Пресвятой_ДжимБим** 15-11-2017

Смыл гидропоники стал теряться. Важнее графики и уровни? Или растения?


**siv237** 15-11-2017

> Смыл гидропоники стал теряться. Важнее графики и уровни? Или растения?

Растения отлично в земле растут. Смысл гидропоники - это обеспечить управляемые и контролируемые условия. Именно поэтому любительской гидропоникой в основном инженеры айти сферы занимаются, а не агрономы.


**Пресвятой_ДжимБим** 15-11-2017

А я всегда думал, что смысл гидропоники это получить бОльший урожай на небольшой площади, и в более краткие сроки, нежели в земле.

Вот я деревня..


**Vad** 15-11-2017

> Растения отлично в земле растут. Смысл гидропоники - это обеспечить управляемые и контролируемые условия. Именно поэтому любительской гидропоникой в основном инженеры айти сферы занимаются, а не агрономы.

и радуются как щенята, когда получается вырастить ТАК ЖЕ как в земле :D

потому что, для них главное - чтоб булькало, мигало, рисовало графики..

:D

одно слово - дети $)


**siv237** 15-11-2017

> и радуются как щенята, когда получается вырастить ТАК ЖЕ как в земле :D
> 
> потому что, для них главное - чтоб булькало, мигало, рисовало графики..
> 
> :D
> 
> одно слово - дети $)

примерно так и есть :)


